<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Android App Architecture</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-interactiveBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="a5b729d0-f163-4d16-b92e-a8f90c7a4034" class="page sans"><header><div class="page-header-icon undefined"><img class="icon" src="Android%20App%20Architecture%20a5b729d0f1634d16b92ea8f90c7a4034/androiddev.jpg"/></div><h1 class="page-title">Android App Architecture</h1><p class="page-description"></p></header><div class="page-body"><nav id="78946455-bde5-4794-807b-4160dd05ddec" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#9971b806-06c4-48cf-9b2c-9351fc4ac9a0">Separation of Concerns</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#a41b4f4a-00f8-43de-b94f-f05f2ce7e725">File structure</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#52f89c77-1ac1-4a10-bf39-b3562cf2f7d7">Launcher Icon</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#1a722a99-be65-42ae-aeda-ec700fac6abc">Materials Design</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#80bc73ff-88d8-4143-9979-9d32e817a5b3">Material Theme</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#cc3d82e5-be58-4038-b2ba-9e48d786f039">Color</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#fd6ad3a5-224e-4940-b302-4e349e74079b">Shape</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#46af2d90-6d6b-48de-a490-90f78e49bcbd">Typography</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#a459dfcf-8b38-468f-b634-183a8aec832e">Values</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#4e07eafc-9f5a-4788-a57c-384f2f1649fa">Dimensions</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#d1997bb1-1d59-445c-a2b5-32f63835cc1c">TopAppBar</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#3e219448-002b-4f23-b210-bb58fa17c6bd">Classes</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#f72fc40b-dd97-48ed-bf3d-d5fc1466b42f">Data Class</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#e9855d6d-3382-457d-ac25-d6775114e001">ViewModel</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#dd4cba07-0067-499c-8926-5ea5a49c9ab1">Build</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#3545223b-3be7-4908-bf64-06a64117e630">Automated Testing</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#d64373af-1745-4eba-ad22-5769cb0648ec">Local Tests</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#3a8f8193-e394-4299-a1ce-dad6fcc42ad1">UI Tests</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#48167ff1-eda9-451c-aa69-d3f2d9737f51">Instrumentation Tests</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#c3edc775-a0ea-420d-8eb1-30a590ba860d">Testing with fake data:</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#5f07082b-f9f7-46b8-a8c7-98d20b298238">Adaptive Layouts</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#3535397d-e783-4ab5-9afb-a63560e4189b">Breakpoints</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#60404da3-3792-498b-9ba2-53b4a6c93ccf">Canonical Layouts</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#09ee6fd1-62d5-4c91-9cdc-714eb2381eb1">Large Screen Readiness</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#bd86ef9d-4c6d-4fca-af36-02bbdd425995">REST</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#988b7b2b-edb0-4452-82a5-1969a1baf08a">Retrofit Library</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#3cdb300b-c99f-4bdc-b5a6-69ebd18cb327">Kotlin Serialization Converter</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#b4c35b3d-222a-456d-979c-2dfb141b1d92">Permissions</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#af8096fe-ee74-4459-a02c-2961a7dc4170">Retrofit Step-By-Step</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#d7c64a89-7158-45ba-bddd-17e109295dbc">Data Layer</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#e9c732b0-8f55-4640-8191-1cf5eca8eb92">Dependency Injection</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#76cf0d99-17a0-4879-b0af-3e03340f3bfe">Creating a multi-screen adaptive repository app with testing</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#33b2952d-e084-4154-ac41-0734e29e6994">Creating a network-interfacing API with Data Layer</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#127ad748-5d8c-4d54-ad90-8e3be9ad2f98">SQLite</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#f1098aea-b178-4d0a-962b-78cce59ce51f">Room</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#2b84b5f8-6fc4-4559-937e-c8929ca7060b">Room Step-By-Step Implementation</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#038355b1-1282-4968-997a-465ce2f37f35">Miscellaneous</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#21bcc5c2-c3c2-424d-ac55-6522cb4158ac">ShareSheet</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#571085f5-7a44-4808-9240-b45f20bd26d3">Further Reading</a></div></nav><p id="64a445ac-8082-40a2-9db1-3f102da0a708" class="">
</p><p id="c9b71ca1-280f-48b9-b675-1ab1ee2d506f" class="">
</p><p id="cf07371b-10a3-4959-a2bd-f37cc4471a1e" class="">
</p><h2 id="9971b806-06c4-48cf-9b2c-9351fc4ac9a0" class="">Separation of Concerns</h2><ul id="a7486dfe-469a-4b44-b701-8dd043dd040d" class="bulleted-list"><li style="list-style-type:disc">Interfaces</li></ul><ul id="0baef147-3ebe-47ec-866c-4265b649616e" class="bulleted-list"><li style="list-style-type:disc">Encapsulation</li></ul><ul id="ffdb1a53-dc9f-4900-b2fb-bc0707d52446" class="bulleted-list"><li style="list-style-type:disc">Modularity</li></ul><ul id="c15b2108-abe5-4d26-8f55-4e220c52b70b" class="bulleted-list"><li style="list-style-type:disc">Testing Each Piece</li></ul><ul id="14b08f01-0232-4d1a-b9ce-f56eda524f22" class="bulleted-list"><li style="list-style-type:disc">Test Coverage</li></ul><ul id="7dd1e089-752e-47ac-a2d3-ec7c23b4db43" class="bulleted-list"><li style="list-style-type:disc">Drive UI from a model (preferable persistent)</li></ul><ul id="72eb3f29-d71d-4162-82eb-434bc6e1e324" class="bulleted-list"><li style="list-style-type:disc">Lifecycle Dependencies<ul id="dfe92ab5-a976-4b55-8903-0d2a74d1f756" class="bulleted-list"><li style="list-style-type:circle">The activity lifecycle is tied to the Android operating system and may be paused, stopped or even destroyed by the system.</li></ul><ul id="ed463672-4b19-4893-a6d7-a76ff7a0f0f7" class="bulleted-list"><li style="list-style-type:circle">Minimal possible code should be put into activities</li></ul><ul id="1cadf1ad-c7b2-4792-ad4e-9b8f9f73d337" class="bulleted-list"><li style="list-style-type:circle">Maximal code should be put in classes that don’t depend on Android APIs  (more easily unit tested)</li></ul></li></ul><ul id="82d2d4d7-aaf2-4239-9efd-47f3c659cda7" class="bulleted-list"><li style="list-style-type:disc">Layered Architecture<ul id="ef217973-7c87-4fd0-9dbd-db12e14ebd05" class="bulleted-list"><li style="list-style-type:circle">UI / Presentation Layer<ul id="fba4b20c-ef00-4649-a2a7-8d4303c446de" class="bulleted-list"><li style="list-style-type:square">Components that render data on the screen (Compose Elements)</li></ul><ul id="aaffa223-c31d-4346-9af5-e479bd0ef619" class="bulleted-list"><li style="list-style-type:square">User interactions</li></ul><ul id="f0e7dafc-1faf-4076-ba7f-079485286a4b" class="bulleted-list"><li style="list-style-type:square">OS interactions</li></ul><ul id="0f65924f-5978-429c-9e36-0bf9f838078b" class="bulleted-list"><li style="list-style-type:square">App layout and screens</li></ul></li></ul><ul id="f7f515eb-bed4-4222-ac96-7851f360d595" class="bulleted-list"><li style="list-style-type:circle">(optional) Domain Layer</li></ul><ul id="9050329f-86e2-42bb-8742-262af4a019c7" class="bulleted-list"><li style="list-style-type:circle">Data Layer<ul id="2f83d6a4-ca4d-4a41-9075-41198f2519e0" class="bulleted-list"><li style="list-style-type:square">Information within the app</li></ul></li></ul><ul id="26698879-0adb-43dd-b97b-59807619f512" class="bulleted-list"><li style="list-style-type:circle">Unidirectional Data Flow<ul id="c5600ae6-fa17-4caf-a3a0-dca37a97dc62" class="bulleted-list"><li style="list-style-type:square">A UDF design pattern is one where state flows down and events flow up. This allows us to decouple Composables that display state from the parts of the app that store and change state.</li></ul><ul id="0b8c7e63-31f9-4983-9eb6-d6e5360655fe" class="bulleted-list"><li style="list-style-type:square">Events flow from UI layer to Data layer<ul id="1ed2ad07-3967-4dcd-84ea-3872e7713ebc" class="bulleted-list"><li style="list-style-type:disc">Initiated by the user or Android system</li></ul></li></ul><ul id="d209c509-172d-4a92-a68f-a26fe50ad46c" class="bulleted-list"><li style="list-style-type:square">Data flows from Data layer to UI layer</li></ul><ul id="c2d3f928-f768-4024-b170-fa95e48833ed" class="bulleted-list"><li style="list-style-type:square">UI Update Loop:<ul id="2753aa8f-4fd7-4715-a10c-9d57770bf87a" class="bulleted-list"><li style="list-style-type:disc">Event: the UI generates an event and passes it up</li></ul><ul id="26b9f1cc-064e-4f94-bc09-fa210dc078c7" class="bulleted-list"><li style="list-style-type:disc">Update State: an event handler changes the state</li></ul><ul id="4715e11e-51ef-4857-9990-dff9077f7f3a" class="bulleted-list"><li style="list-style-type:disc">Display State: the state holder passes down the state to the UI</li></ul><ul id="c6de91a3-000a-483f-a6fb-6cc4d6c74b83" class="bulleted-list"><li style="list-style-type:disc">Repeat: for any events that cause mutation of state</li></ul></li></ul></li></ul><ul id="a4794806-a3a6-4ad3-af62-964d70aa837d" class="bulleted-list"><li style="list-style-type:circle">UI Layer Pipeline<ol type="1" id="8f5f6fda-1daa-47d5-a245-a3bc6018b984" class="numbered-list" start="1"><li>App data → UI data</li></ol><ol type="1" id="f63a21a4-1e18-4217-be02-8dedde8d8f11" class="numbered-list" start="2"><li>UI data → UI elements</li></ol><ol type="1" id="994c327b-8efd-407b-8b26-4ba2eb274f22" class="numbered-list" start="3"><li>User Events</li></ol><ol type="1" id="a207e5b6-31af-4c9b-81e7-0cebac7d71d8" class="numbered-list" start="4"><li>Repeat as long as necessary</li></ol></li></ul><ul id="8bfa3aa5-a0ab-4547-9719-3b656fcb823c" class="bulleted-list"><li style="list-style-type:circle">UI Layer Concepts<ol type="1" id="987a555e-eeb1-4534-8e4d-047ff5812be5" class="numbered-list" start="1"><li>Define UI state<ol type="a" id="956adde3-ccd7-4b5b-a555-1800599f0747" class="numbered-list" start="1"><li>UI state definition should be immutable</li></ol><ol type="a" id="85fb24ab-2806-4f91-8a67-a44722711572" class="numbered-list" start="2"><li>UI should read the stat and update accordingly</li></ol><ol type="a" id="503df7a1-e474-4ab2-893e-dd0d60ab4af4" class="numbered-list" start="3"><li>UI should NOT update its own state directly unless it is the sole source of its data</li></ol></li></ol><ol type="1" id="683042b0-7c45-466e-a62a-62336d7b9b42" class="numbered-list" start="2"><li>Production of UI state</li></ol><ol type="1" id="33a44046-1ca4-46ab-b8f0-9bd81dfb98a9" class="numbered-list" start="3"><li>Expose UI state</li></ol><ol type="1" id="66253718-d53b-41eb-8499-25746eafb88c" class="numbered-list" start="4"><li>Consume UI state</li></ol></li></ul><ul id="ea9c681b-a977-4a23-a864-f71bdeddc01c" class="bulleted-list"><li style="list-style-type:circle">ViewModel<figure id="1ff6a69d-0e1c-4717-93c2-922b827231c7" class="image"><a href="Android%20App%20Architecture%20a5b729d0f1634d16b92ea8f90c7a4034/Untitled.png"><img style="width:429px" src="Android%20App%20Architecture%20a5b729d0f1634d16b92ea8f90c7a4034/Untitled.png"/></a></figure></li></ul><p id="552b69be-168a-4ac7-a05c-f2d668189b6f" class=""><div class="indented"><ul id="0b74b8bc-d6ef-4822-b0bc-178881bdf31e" class="bulleted-list"><li style="list-style-type:disc">Is responsible for managing state and thus separating UI from having to manage state.</li></ul><ol type="1" id="596f4e71-b4f6-4b35-946f-33a0114d756e" class="numbered-list" start="1"><li>ViewModel holds the state and exposes state to the UI</li></ol><ol type="1" id="cc18ccf9-3ada-46c1-b085-af600563bdb1" class="numbered-list" start="2"><li>UI notifies ViewModel of events</li></ol><ol type="1" id="1f65c5eb-9289-47f1-98ef-f48942e26bd8" class="numbered-list" start="3"><li>ViewModel updates state and is consumed by the UI</li></ol><ol type="1" id="6ab2009f-9e42-487b-8185-93ca42fd6599" class="numbered-list" start="4"><li>Repeat</li></ol><ul id="403b7286-f60b-41be-b1b2-a0ef3ba0173f" class="bulleted-list"><li style="list-style-type:disc">ViewModel methodology ensures that UI events go in and state comes out.</li></ul></div></p><ul id="d4ebe480-da3a-4677-afd0-6fe3157f69bd" class="bulleted-list"><li style="list-style-type:circle">UI state exposure<ul id="57be5e41-4b38-451c-9da8-6c4386351241" class="bulleted-list"><li style="list-style-type:square">Occurs via observable data such as <code>StateFlow</code> or <code>LiveData</code><ul id="2152e379-a13a-46c8-a99b-2875ef215f34" class="bulleted-list"><li style="list-style-type:disc"><code>StateFlow</code> is a data holder observable that emits current and new state updates. In order to update state and send it to flow, assign a new value to <code>MutableStateFlow</code>.</li></ul></li></ul><ul id="0bbc5eb0-5ab0-49f0-a296-b399d3ca1cbd" class="bulleted-list"><li style="list-style-type:square">Can also use <code>mutableStateOf</code> or <code>snapshotFlow</code> in Jetback Compose</li></ul><ul id="e7dc125c-23f4-4e57-8f51-46de2dc7c50a" class="bulleted-list"><li style="list-style-type:square">These also have the latest version of the UI state cached for rapid restoration</li></ul></li></ul><ul id="5de8cbe9-2d2e-48db-a6ae-0b32e2b8bdfc" class="bulleted-list"><li style="list-style-type:circle">Backing Property<ul id="8755a298-aa00-430e-b0ab-277b2b7f3fc6" class="bulleted-list"><li style="list-style-type:square">Allows you to return something from a getter other than the exact object</li></ul><ul id="6326af7b-ab82-4110-b19a-f345ead34611" class="bulleted-list"><li style="list-style-type:square">Within Kotlin, the <code>var</code> property has pre-generated getters and setters, which can be overridden.</li></ul><ul id="17c1c903-a7e9-4bd4-a0cf-14c3c96cec22" class="bulleted-list"><li style="list-style-type:square">To implement backing properties, you override the getter method for one variable (or value) to return a read-only version of your data.<ul id="d736be07-8d13-4f68-a825-af6f08d72e37" class="bulleted-list"><li style="list-style-type:disc">Example:<ul id="60836306-33ee-4b70-ad6a-fe6af6313406" class="bulleted-list"><li style="list-style-type:circle"><code>private var _count = 0</code></li></ul><ul id="5c2dddcb-5866-44ad-8aff-cfd0824ecf9e" class="bulleted-list"><li style="list-style-type:circle"><code>val count: Int</code><ul id="ee6f09a9-0f2b-4239-8bf4-05a8921c818d" class="bulleted-list"><li style="list-style-type:square"><code>get() = _count</code></li></ul></li></ul></li></ul></li></ul><ul id="3676472c-1091-48b1-96bc-1c813131fb16" class="bulleted-list"><li style="list-style-type:square">The outcome of this is that the <code>private</code> variable is not accessible or editable outside of the class BUT the val count is accessible, but not modifiable, making it immutable and read-only. This protects the data inside ViewModel from outside tampering.</li></ul><ul id="9188a704-b8b2-4810-b24d-f0c8621d765b" class="bulleted-list"><li style="list-style-type:square">Within a ViewModel approach, this can be achieved by:<ul id="09a17a57-dc1d-43fb-9565-96d47ed4cdf4" class="bulleted-list"><li style="list-style-type:disc"><code><em>private val </em></code><code>_uiState = MutableStateFlow(GameUiState())</code></li></ul><ul id="b97c0796-7350-4ad0-a410-fe3e941baa2f" class="bulleted-list"><li style="list-style-type:disc"><code><em>val </em></code><code>uiState: StateFlow&lt;GameUiState&gt; = _uiState.asStateFlow()</code></li></ul></li></ul></li></ul></li></ul><h2 id="a41b4f4a-00f8-43de-b94f-f05f2ce7e725" class="">File structure</h2><ul id="29ad17a3-38b4-4559-ab41-c5168a02662d" class="bulleted-list"><li style="list-style-type:disc">Resources such as images and strings should always be separated from your code so they may be more easily maintained</li></ul><ul id="6952a4a1-02ed-4da6-a11e-18b8558dfe6c" class="bulleted-list"><li style="list-style-type:disc">Example file structure for a simple app:<ul id="9fb701d3-9191-4203-8a5f-6a7d2d5d54af" class="bulleted-list"><li style="list-style-type:circle">app/src/main<ul id="2e1e7035-d8ae-44c9-8292-733f2a14ac9e" class="bulleted-list"><li style="list-style-type:square">java<ul id="f6588a1e-01c7-4d49-812c-a78802b630ee" class="bulleted-list"><li style="list-style-type:disc">MainActivity.kt</li></ul><ul id="0a412647-2d0e-4087-b700-1bdc4376e090" class="bulleted-list"><li style="list-style-type:disc">data<ul id="1685beaa-96bf-41bb-83e5-c6f0ef42af8b" class="bulleted-list"><li style="list-style-type:circle">Datasource</li></ul></li></ul><ul id="763edfd7-1ff9-4c42-ab11-9da8aed84d70" class="bulleted-list"><li style="list-style-type:disc">model<ul id="817673f9-2f0e-4eb4-9e27-e865344d2e90" class="bulleted-list"><li style="list-style-type:circle">Data Class</li></ul></li></ul><ul id="07fc2b90-0d28-4732-b530-e4d1b1c58105" class="bulleted-list"><li style="list-style-type:disc">ui.theme</li></ul></li></ul><ul id="4b845d96-a5e1-4c23-81b6-5f1139da2fc3" class="bulleted-list"><li style="list-style-type:square">res<ul id="0ef163fd-06a9-411a-8ac0-294294f1e8fb" class="bulleted-list"><li style="list-style-type:disc">drawable<ul id="75e89ae1-202a-4d84-963b-df9ebd73ee51" class="bulleted-list"><li style="list-style-type:circle">graphic.png</li></ul></li></ul><ul id="1d79b549-33bc-4e73-94c2-46d3ecc67215" class="bulleted-list"><li style="list-style-type:disc">mipmap<ul id="9c28d1f6-d5a7-4400-bd82-9a399dcc386f" class="bulleted-list"><li style="list-style-type:circle">icon.png</li></ul></li></ul><ul id="9e9afa3e-7638-4048-8c78-60b9b97938e7" class="bulleted-list"><li style="list-style-type:disc">values<ul id="e1120fe5-d558-4268-8a2d-08a105187cd1" class="bulleted-list"><li style="list-style-type:circle">strings.xml</li></ul></li></ul></li></ul></li></ul></li></ul><p id="127b4226-a871-4a56-884b-9bb06ad7b357" class="">
</p><h2 id="52f89c77-1ac1-4a10-bf39-b3562cf2f7d7" class="">Launcher Icon</h2><p id="936b7fb9-4e2d-48cd-9ee7-4f07218b7dc8" class="">Image assets should be placed in mipmap folders depending on their scalability.</p><ul id="9e62359a-415f-4dd2-8bec-46bbefc2b16a" class="bulleted-list"><li style="list-style-type:disc">mipmap<ul id="01bb1463-d674-4c8a-8ca7-0a8fceb59198" class="bulleted-list"><li style="list-style-type:circle">mdpi<ul id="a1534a9d-7522-44f8-b00f-a004025ffa0a" class="bulleted-list"><li style="list-style-type:square">medium ~ 160dpi</li></ul></li></ul><ul id="81ecb57b-a08e-48cb-8b2e-3b5ed421b4b2" class="bulleted-list"><li style="list-style-type:circle">hdpi<ul id="02865449-fda9-4fee-a090-af879b2f6813" class="bulleted-list"><li style="list-style-type:square">high ~ 240dpi</li></ul></li></ul><ul id="353d3e96-9a04-4c08-a46d-842bddb76772" class="bulleted-list"><li style="list-style-type:circle">xhdpi<ul id="0432583f-d7f1-4a03-87e7-8a0f4f25c6fd" class="bulleted-list"><li style="list-style-type:square">extra-high ~ 320dpi</li></ul></li></ul><ul id="fd3cac5a-d2b6-44f3-a313-b1b1a9784d76" class="bulleted-list"><li style="list-style-type:circle">xxhdpi ~ 480</li></ul><ul id="37f26ed0-0de0-4216-84d4-61ab31fe3244" class="bulleted-list"><li style="list-style-type:circle">xxxhdpi ~ 640</li></ul><ul id="d0406ec4-0f04-4100-b24c-e1eab411d1a9" class="bulleted-list"><li style="list-style-type:circle">nodpi<ul id="19cb04ba-e96c-4b34-b1f9-f35b66831e4b" class="bulleted-list"><li style="list-style-type:square">should not be scaled, regardless of density</li></ul></li></ul><ul id="0cf6726b-c873-4d99-9893-10022684f856" class="bulleted-list"><li style="list-style-type:circle">anydpi-v26<ul id="5a7425ef-9498-4acc-886c-77edeaba071a" class="bulleted-list"><li style="list-style-type:square">fully scalable, can be scaled to any density, implemented in API version 26</li></ul></li></ul></li></ul><p id="d85c60c0-ffda-4ce0-9d4e-b77490933e73" class="">The <code>ic_launcher.webp</code> file contains the square version of the icon while the <code>ic_launcher_round.webp</code>contains the circular version of the icon. Adaptive icons are made up of a foreground and a background layer with a superimposed mask.</p><ul id="2e1ba461-ebdb-4671-8167-12f3f10a2390" class="bulleted-list"><li style="list-style-type:disc">Adaptive icons foreground and background images must be 108 x 108 dpi</li></ul><ul id="792c6000-ed66-4fb4-bef2-4774d5852d28" class="bulleted-list"><li style="list-style-type:disc">It is recommended to keep the important parts of the image inside the ‘safe zone’ to avoid clipping by device manufacturers </li></ul><ul id="6d7aff9c-9699-45a3-9476-6dc7b218a96b" class="bulleted-list"><li style="list-style-type:disc">Prior to replacing the existing launcher icon it is recommended to first delete all mipmap folders and launcher image assets</li></ul><p id="356406c3-6390-4153-8598-9c72c6246b62" class="">
</p><h2 id="1a722a99-be65-42ae-aeda-ec700fac6abc" class="">Materials Design</h2><p id="857ef616-5300-4e53-a48b-95d38fe8fa42" class="">Material IO website: material.io</p><h3 id="80bc73ff-88d8-4143-9979-9d32e817a5b3" class="">Material Theme</h3><p id="502c8f07-3528-420e-a085-306ea6b0320f" class="">Stored in the <code>Theme.kt</code> file under java→com→example→appname→ui→theme</p><pre id="99566daa-d741-4701-8d77-87829f582933" class="code code-wrap"><code>@Composable
fun WoofTheme(
   darkTheme: Boolean = isSystemInDarkTheme(),
   dynamicColor: Boolean = false,
   content: @Composable () -&gt; Unit
) {
   val colorScheme = when {
       dynamicColor &amp;&amp; Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.S -&gt; {
           val context = LocalContext.current
           if (darkTheme) dynamicDarkColorScheme(context) else dynamicLightColorScheme(context)
       }

       darkTheme -&gt; DarkColors
       else -&gt; LightColors
   }
   val view = LocalView.current
   if (!view.isInEditMode) {
       SideEffect {
           val window = (view.context as Activity).window
           window.statusBarColor = colorScheme.primary.toArgb()
           WindowCompat.getInsetsController(window, view).isAppearanceLightStatusBars = darkTheme
       }
   }

   MaterialTheme(
       colorScheme = colorScheme,
       shapes = Shapes,
       typography = Typography,
       content = content
   )
}</code></pre><p id="19961793-8650-4fe5-a2b1-e57bafcfbb8d" class="">
</p><h3 id="cc3d82e5-be58-4038-b2ba-9e48d786f039" class="">Color</h3><p id="aebcfbef-de66-46bd-a0fb-2412aa3d4b91" class="">Stored in <code>Color.kt</code> file in the theme directory</p><ul id="b4ae8849-af86-4f09-a3c9-1e0c2545b6d6" class="bulleted-list"><li style="list-style-type:disc">Use the Material Theme Builder:<ul id="f767ebb9-acd5-4314-bdec-23de257b3cb5" class="bulleted-list"><li style="list-style-type:circle"><a href="https://m3.material.io/theme-builder#/custom">https://m3.material.io/theme-builder#/custom</a></li></ul><ul id="a8dd3896-a18d-4303-990a-c5216b1fc7fa" class="bulleted-list"><li style="list-style-type:circle">Export as Jetpack Compose (Theme,kt)</li></ul></li></ul><ul id="6a83c033-671e-4067-8e82-38014b4157ba" class="bulleted-list"><li style="list-style-type:disc">All colors are represented in hexadecimal format</li></ul><ul id="7e53607a-af10-4658-a281-2c23a7cdc9ba" class="bulleted-list"><li style="list-style-type:disc">Material components are automatically mapped to color slots, which can be overridden in code where needed</li></ul><ul id="eb9f01af-30c0-4ad8-a73b-effc8f4de800" class="bulleted-list"><li style="list-style-type:disc">Dynamic Color<ul id="b0b8fdf3-8718-41f5-b286-ab7930d22ef5" class="bulleted-list"><li style="list-style-type:circle">Creates a theme for the user based on the user’s wallpaper, available on devices running Android 12 and up</li></ul></li></ul><p id="5bddcc21-42b0-4be0-b5b0-d2c953bbb5a2" class="">
</p><h3 id="fd6ad3a5-224e-4940-b302-4e349e74079b" class="">Shape</h3><p id="368c001a-7b09-4174-aad4-9e3600b3530c" class="">Jetpack Compose elements are grouped into shape categories based on their size:</p><table id="146eefc0-3f46-46ee-b789-e08205e99042" class="simple-table"><tbody><tr id="f4c44ea0-7f11-4b93-a785-cc7ae3fabfb7"><td id="QSlZ" class=""><strong>Shape style</strong></td><td id="yXD&gt;" class=""><strong>Component</strong></td></tr><tr id="1704852c-0933-4b1e-920c-75b7e7a5cfa5"><td id="QSlZ" class="">None</td><td id="yXD&gt;" class="">BannersBottom app barsFull-screen dialogsListsNavigation barsNavigation railsProgress indicatorsSearch view (full-screen)Side sheets (docked)TabsTop app bars</td></tr><tr id="2f5e401d-2c8c-4907-8731-0ffd3513ae18"><td id="QSlZ" class="">Extra small</td><td id="yXD&gt;" class="">Autocomplete menuSelect menuSnackbarsStandard menuText fields</td></tr><tr id="1efc978c-e7b3-47bd-911b-49b13f49b3ac"><td id="QSlZ" class="">Small</td><td id="yXD&gt;" class="">ChipsRich tooltip</td></tr><tr id="4d2cd8ac-9ed1-4ce8-bf55-f4cc212c4397"><td id="QSlZ" class="">Medium</td><td id="yXD&gt;" class="">CardsSmall FABs</td></tr><tr id="6252d38f-2e50-4ede-b127-c3d70cd6fe85"><td id="QSlZ" class="">Large</td><td id="yXD&gt;" class="">Extended FABsFABsNavigation drawers</td></tr><tr id="7d7dfd2c-6fc9-46d2-9df3-bc760efbe66c"><td id="QSlZ" class="">Extra large</td><td id="yXD&gt;" class="">Bottom sheets (docked)DialogsFloating sheetsLarge FABsSearch view (docked)Time pickerTime input</td></tr><tr id="4fd93794-c059-4526-9939-d9569fabda08"><td id="QSlZ" class="">Full</td><td id="yXD&gt;" class="">BadgeButtonsIcon buttonsSlidersSwitchesSearch bar</td></tr></tbody></table><p id="3f05c40d-1535-40c6-88da-0702a1e470c7" class="">
</p><h3 id="46af2d90-6d6b-48de-a490-90f78e49bcbd" class="">Typography</h3><p id="445d12b8-65fa-4227-8757-bc9430a6bbfa" class="">Stored in  res → font</p><p id="83abfa53-c513-4fe9-a57e-a874bafe4670" class="">In order to create this, use the new → android resource directory → font</p><p id="b5e7f709-ac6a-4a5e-be7f-a8c28493c87a" class="">Consider downloading custom fonts from fonts.google.com</p><p id="4188fb5c-44ef-4e03-afe0-31e462befd06" class="">The material design type scale includes fifteen font styles that are supported by the type system. There are 5 categories each with 3 sizes each: small, medium and large:</p><ul id="b089f675-c56d-4ebb-b711-df715166a0a8" class="bulleted-list"><li style="list-style-type:disc">Display - the largest text on the screen, reserved for important text and numerals</li></ul><ul id="626728bf-495c-472e-bb6e-d9ca746d6fd1" class="bulleted-list"><li style="list-style-type:disc">Headline - best used for high emphasis text and primary passages</li></ul><ul id="0301a7ac-67ce-4930-8e01-b1e7629955f0" class="bulleted-list"><li style="list-style-type:disc">Title - smaller than headlines and used for medium-emphasis text that is relatively short</li></ul><ul id="7574202a-4ed3-440f-add6-aec069c7ae5d" class="bulleted-list"><li style="list-style-type:disc">Body - used for longer passages of text</li></ul><ul id="548e1a0f-6e2c-44a9-8af5-1fc47d6aaeba" class="bulleted-list"><li style="list-style-type:disc">Label - small and utilitarian, often used for text inside components or for captions</li></ul><p id="4f680914-b14c-4683-9b52-4925f67d1102" class="">Consider downloading custom fonts from fonts.google.com. After the desired fonts have been downloaded:</p><ul id="4cf4e885-3b8c-4c32-acbf-6e709d2f293b" class="bulleted-list"><li style="list-style-type:disc">Rename all files by removing hyphens and whitespace and replacing with lowercase and ‘_’</li></ul><ul id="31e6e4b9-f267-4d4c-b512-2ee9e9624c49" class="bulleted-list"><li style="list-style-type:disc">Create font folder in the res directory<ul id="3bbcf8ce-481f-415c-acdb-9e5698f90cb5" class="bulleted-list"><li style="list-style-type:circle">new → Android Resource Directory → font → font</li></ul><ul id="4b30d494-1921-4f52-99bf-3c4a5b08fc34" class="bulleted-list"><li style="list-style-type:circle">upload fonts</li></ul></li></ul><ul id="53382bd2-10c8-4ae8-af66-f9619233d226" class="bulleted-list"><li style="list-style-type:disc">Initialise Fonts:<ul id="50ac2306-157f-4cbd-96ce-33d5c197cc80" class="bulleted-list"><li style="list-style-type:circle">in ui.theme → Type.kt </li></ul><pre id="24f35c88-e807-46d6-9512-79dd33348a4a" class="code code-wrap"><code>import androidx.compose.ui.text.font.Font
import androidx.compose.ui.text.font.FontFamily
import com.example.woof.R

val Monserrat = FontFamily(
    Font(R.font.montserrat_regular),
    Font(R.font.montserrat_bold, FontWeight.Bold)
)</code></pre></li></ul><ul id="bab75c49-920d-47bb-9d54-04c215674676" class="bulleted-list"><li style="list-style-type:disc">After initialisation, set the different types of headlines, bodies, etc to the fonts that have been added.</li></ul><pre id="7d43100f-48c1-4cad-9582-4a8c382e7c5a" class="code code-wrap"><code>import androidx.compose.ui.text.TextStyle
import androidx.compose.ui.unit.sp


val Typography = Typography(
   displayLarge = TextStyle(
       fontFamily = AbrilFatface,
       fontWeight = FontWeight.Normal,
       fontSize = 36.sp
   ),
   displayMedium = TextStyle(
       fontFamily = Montserrat,
       fontWeight = FontWeight.Bold,
       fontSize = 20.sp
   ),
   labelSmall = TextStyle(
       fontFamily = Montserrat,
       fontWeight = FontWeight.Bold,
       fontSize = 14.sp
   ),
   bodyLarge = TextStyle(
       fontFamily = Montserrat,
       fontWeight = FontWeight.Normal,
       fontSize = 14.sp
   )
)</code></pre><ul id="0fb21c01-cb4b-46b1-bd9b-a6871d062be1" class="bulleted-list"><li style="list-style-type:disc">Finally, go to <code>Theme.kt</code> and ensure that within <code>MaterialTheme()</code>, the typography is equal to the typography value that has just been updated.</li></ul><p id="13b4bede-6bd1-4c92-9e5e-42b9d5b327d1" class="">Once this has been completed, fonts can now be used using the <code>style = MaterialTheme.typography.[fontCategory]</code> parameter within Text and other composables.</p><p id="f2c74caa-904f-4879-bc30-b319640430ca" class="">
</p><p id="a482447d-3207-429f-a6cd-457ea90c5159" class="">
</p><p id="f16631bd-0612-4b8d-81fa-8edcb1e30545" class="">
</p><h2 id="a459dfcf-8b38-468f-b634-183a8aec832e" class="">Values</h2><h3 id="4e07eafc-9f5a-4788-a57c-384f2f1649fa" class="">Dimensions</h3><p id="76f8aa00-2534-4c6d-8826-19e92902273f" class="">Stored in <code>dimens.xml</code> in the res→ values folder</p><ul id="2d361743-a6bc-4246-b35e-02029a43b477" class="bulleted-list"><li style="list-style-type:disc">padding_small</li></ul><ul id="e78b18f8-3639-4bf8-872d-5f029331c435" class="bulleted-list"><li style="list-style-type:disc">padding_medium</li></ul><ul id="129ec1ac-e16d-4721-bdb8-b77d0efcbdda" class="bulleted-list"><li style="list-style-type:disc">padding_large</li></ul><p id="9cd898b1-1146-493c-a76f-44d6bae65655" class="">
</p><h3 id="d1997bb1-1d59-445c-a2b5-32f63835cc1c" class="">TopAppBar</h3><p id="918eb539-00fc-4e6f-badb-13e6455ffeb2" class="">Within Compose, a Scaffold is used to provide slots for various visual components and screen elements such as images, rows, columns and a Top App Bar.</p><ul id="dd768c1b-7853-4b02-a3c0-7d1eea370a2d" class="bulleted-list"><li style="list-style-type:disc">In order to create a top app bar, the contents must first be surrounded by a <code>Scaffold()</code> Composable<ul id="057683f1-adf4-4906-bf17-9d0ac2c68c16" class="bulleted-list"><li style="list-style-type:circle">The Scaffold supports the <code>contentWindowInsets</code> parameter to specify the insets for scaffold content.<ul id="ff5d5bf4-2a24-4408-84b7-ecaf4b3124dc" class="bulleted-list"><li style="list-style-type:square">These are the parts of the screen where the app can intersect with the system UI, passed to the content slot via the PaddingValues parameter</li></ul><ul id="e32b3c5f-a70a-41e5-ad36-dfc4db572e82" class="bulleted-list"><li style="list-style-type:square">The Scaffold accepts a <code>topBar</code> parameter with a value of <code>() -&gt; Unit</code>, which can be passed the created Top Bar Composable </li></ul><pre id="1fa941f6-b93c-490c-baa1-a995ce642883" class="code code-wrap"><code>@Composable
funWoofApp() {
    Scaffold(
        topBar = { WoofAppTopBar() }
    ) {
        LazyColumn(contentPadding = it) {
            items(dogs) {
                DogItem(
                    dog = it,
                    modifier = Modifier
                        .padding(dimensionResource(R.dimen.padding_small))
                )
            }
        }
    }
}</code></pre></li></ul></li></ul><ul id="cd19132b-b5df-4399-93aa-7d5835fa6775" class="bulleted-list"><li style="list-style-type:disc">Top App Bar:<ul id="58dda138-adaa-4f75-9cdd-2a091a976256" class="bulleted-list"><li style="list-style-type:circle">Can be created using the <code>CenterAlignedTopAppBar</code> composable</li></ul><ul id="515b6f55-a30e-4adc-9a87-16d148ad7316" class="bulleted-list"><li style="list-style-type:circle">Can also be created using the <code>TopAppBar</code>:</li></ul><pre id="c0447ed4-9da4-4afe-9c77-2184adcd06d5" class="code"><code>fun SomethingAppBar(
	currentScreen: LunchTrayAppScreen,
	canNavigateBack: Boolean,
	navigateUp: () -&gt; Unit,
	modifier: Modifier = Modifier
) {}</code></pre></li></ul><ul id="dec48433-e685-4a38-b132-48e2e40b0d83" class="bulleted-list"><li style="list-style-type:disc">In order to change color of status bar to match color of app:</li></ul><pre id="eee93d38-3646-4ffd-86e4-a99fdebbd1a7" class="code"><code>val view = LocalView.current
    if (!view.isInEditMode) {
        SideEffect {
            val window = (view.context as Activity).window
            window.statusBarColor = colorScheme.background.toArgb()
            WindowCompat.getInsetsController(window, view).isAppearanceLightStatusBars = !darkTheme
        }
    }</code></pre><ul id="04a1d634-a756-40f9-b792-100f08f9bdbe" class="bulleted-list"><li style="list-style-type:disc">The top bar should, in most cases, have an “up” button to navigate backwards. If you would like the phone’s back button to do the same action, use:<ul id="00f836c9-2fd8-45c2-b806-03f3c9a88271" class="bulleted-list"><li style="list-style-type:circle"><code>BackHandler { onBackPressed() }</code></li></ul></li></ul><h2 id="3e219448-002b-4f23-b210-bb58fa17c6bd" class="">Classes</h2><h3 id="f72fc40b-dd97-48ed-bf3d-d5fc1466b42f" class="">Data Class</h3><p id="b2b202e4-b3e2-4581-9e74-8e967979f1f9" class="">While simple, single pieces of data may be able to be contained in an array, complex data structures may benefit from residing in a data class that contains all of their properties.</p><p id="a775442c-0fd5-4679-85ae-6132ea437b9b" class="">
</p><h2 id="e9855d6d-3382-457d-ac25-d6775114e001" class="">ViewModel</h2><h3 id="dd4cba07-0067-499c-8926-5ea5a49c9ab1" class="">Build</h3><ul id="7048a124-fa9b-4d83-87fe-aa725be03146" class="bulleted-list"><li style="list-style-type:disc">Open <code>build.gradle(Module: app)</code><ul id="3a9d02ef-f4bf-4be4-b876-73be3a504e46" class="bulleted-list"><li style="list-style-type:circle"><code>dependencies {</code><ul id="ac4de58b-cb5c-4e78-b23e-8dcd52b3a43f" class="bulleted-list"><li style="list-style-type:square"><code>implementation &quot;androidx.lifecycle:lifecycle-viewmodel-compose:2.6.1&quot;</code></li></ul></li></ul></li></ul><ul id="1f7ad3b1-06b8-49d6-9f75-695f32c97c03" class="bulleted-list"><li style="list-style-type:disc">Create model class for ViewModel <code>AppViewModel.kt</code> in <code>ui</code> folder<ul id="939a0f0e-c632-4295-a7e1-87ee2ec407be" class="bulleted-list"><li style="list-style-type:circle">make the class extend ViewModel:<ul id="4006610b-ceb7-4696-9e89-a1eb67d04ca0" class="bulleted-list"><li style="list-style-type:square"><code>class AppViewModel : ViewModel() { }</code></li></ul></li></ul></li></ul><ul id="404282cf-df50-46e3-854b-493c7fd90345" class="bulleted-list"><li style="list-style-type:disc">Create model class for State UI <code>AppUiState.kt</code> in <code>ui</code> folder<ul id="4c5d49f6-fbd9-4f53-8f12-1e43ff067193" class="bulleted-list"><li style="list-style-type:circle">make the class a data class and insert constants for immutability:<ul id="361f4f63-0ca3-4a3c-ba12-58bbb12632d6" class="bulleted-list"><li style="list-style-type:square"><code>data class AppUiState(</code><ul id="f014921a-615e-4959-a170-cbfb7c05acb8" class="bulleted-list"><li style="list-style-type:disc"><code>val currentDataStatus: DataType = [value]</code></li></ul></li></ul></li></ul></li></ul><ul id="a5746683-faaa-40cf-a94b-97fe9fbb3a40" class="bulleted-list"><li style="list-style-type:disc">In ViewModel, create a variable to link to state:<pre id="33c6a11a-d0f3-4991-b7fe-8af236d7cefe" class="code code-wrap"><code>// UI state only editable by ViewModel
private val_uiState = MutableStateFlow(DessertUiState())
valuiState: StateFlow&lt;DessertUiState&gt; = _uiState.asStateFlow()</code></pre></li></ul><ul id="b660725e-85a3-418f-b43b-95a9190dcf36" class="bulleted-list"><li style="list-style-type:disc">Pass ViewModel to the Screen<ul id="58b425fe-a835-4ce6-9736-661de9dd7b58" class="bulleted-list"><li style="list-style-type:circle"><code>screenViewModel: ScreenViewModel = viewModel()</code></li></ul></li></ul><ul id="a464bdd7-2305-4fff-9975-c220676ed2ce" class="bulleted-list"><li style="list-style-type:disc">Pass State Ui to Screen<ul id="99f962af-dd74-4c09-9fd5-75b24cdbddd1" class="bulleted-list"><li style="list-style-type:circle"><code>val screenUiState by screenViewModel.uiState.collectAsState()</code></li></ul></li></ul><p id="06b6ba7d-75cc-461e-bd84-7807a91fbf04" class="">
</p><h2 id="3545223b-3be7-4908-bf64-06a64117e630" class="">Automated Testing</h2><p id="12dbf44f-da91-4bd9-9370-0a27f374c94f" class="">It is best practice to write automated tests alongside your app code in order to ensure that each section of code works as expected, and continues to work as expected when it is updated either by yourself, or by others, over time.</p><h3 id="d64373af-1745-4eba-ad22-5769cb0648ec" class="">Local Tests</h3><p id="f23be754-7e30-4db3-837b-0d715fad18f2" class="">Directly test a small piece of code to ensure that it functions properly, executed on the workstation.</p><ul id="dcc387de-5f40-446f-b541-f7b556130e0a" class="bulleted-list"><li style="list-style-type:disc"><code>private</code> function declarations must become <code>internal</code> in order for the test to access them</li></ul><ul id="c3a80cfd-9e1a-4b16-981b-c39706b20205" class="bulleted-list"><li style="list-style-type:disc">Functions must be annotated with <code>@VisibleForTesting</code></li></ul><ul id="9f603da7-5af4-43ed-a381-d8ef4da54d7f" class="bulleted-list"><li style="list-style-type:disc">Create test directory in app → src → test/java<ul id="56f298a2-843c-43c9-aaa7-35e82d4528f6" class="bulleted-list"><li style="list-style-type:circle">The test directory structure must be identical to the app structure. Just as the app is structured as main → java → com → example → appname, the tests must be in the package test → java → com → example → appname</li></ul></li></ul><ul id="8ff72b98-4f4c-4b32-b156-c774fdb7e312" class="bulleted-list"><li style="list-style-type:disc">Annotate the test methods with <code>@Test</code><ul id="b7e7f6ca-a898-484d-b06f-e83594233f10" class="bulleted-list"><li style="list-style-type:circle">if needed, use <code>import org.junit.Test</code></li></ul></li></ul><ul id="8278891a-9694-404e-90f9-1227fbfafb1e" class="bulleted-list"><li style="list-style-type:disc">create the function to conduct the test and finish with some sort of <code>assertEquals()</code> statement</li></ul><ul id="7bac7b8c-3043-4673-b207-309744570412" class="bulleted-list"><li style="list-style-type:disc">click the function arrow to run the test or the multi-function class arrows to run the suite</li></ul><h3 id="3a8f8193-e394-4299-a1ce-dad6fcc42ad1" class="">UI Tests</h3><p id="15bddf17-3921-4711-b67f-c07d4f792c3f" class="">Also known as, and contained within, <code>androidTest</code>s are defined by <code>androidTestImplementation</code> within Gradle to ensure UI dependencies are only compiled while running UI tests and not included within the APK. As with local tests, create the <code>androidTest</code> directory (package) within:<div class="indented"><p id="fae9a689-45b5-4723-a043-3e849c7992a8" class="">src → androidTest → java → com → example → appName → test<div class="indented"><p id="fa95d9b9-0c73-4b73-a73e-3d706fe0f1a0" class="">New Directory: under src: androidTest\java</p><p id="36f711f6-68ab-4db0-aa58-b994cc13b0d5" class="">New Package: under androidTest\java: <code>com.example.appName.test</code></p></div></p></div></p><p id="57d1a27b-519e-444a-b663-c9133a295995" class="">Dependencies:<div class="indented"><pre id="45864f1e-4e28-40ac-90a4-26a15e3fcddd" class="code"><code>androidTestImplementation(platform(&quot;androidx.compose:compose-bom:2023.05.01&quot;))
androidTestImplementation(&quot;androidx.compose.ui:ui-test-junit4&quot;)
androidTestImplementation(&quot;androidx.navigation:navigation-testing:2.6.0&quot;)
androidTestImplementation(&quot;androidx.test.espresso:espresso-intents:3.5.1&quot;)
androidTestImplementation(&quot;androidx.test.ext:junit:1.1.5&quot;)</code></pre></div></p><p id="9f8981df-3e87-42ed-8a7d-3948f343e106" class="">When testing Compose Navigation, you do not have access to the <code>NavHostController</code> that you do in the app code and must thus use a <code>TestNavHostController</code> and configure the test rule with this nav controller.</p><p id="66d7376e-c5f3-4291-8699-93ca727af590" class="">In order to set up UI tests using a NavController, you must first create an instance of this using the @Before annotation, which will cause this to run BEFORE every method annotated with @Test:<div class="indented"><pre id="39861eee-a349-4197-afd0-3300728826a1" class="code"><code>@Before
fun setupCupcakeNavHost() {
	composeTestRule.setContent {
		navController = TestNavHostController(LocalContext.current).apply {
		navigatorProvider.addNavigator(ComposeNavigator())
		}
		CupcakeApp(navController = navController)
	}
}</code></pre></div></p><p id="36b7ff85-c6c0-4423-80eb-2c962be0c104" class="">In order to create helper methods for assistance in UI testing, create a descriptive file named SomeKindOfAssertion.kt under the test directory and store your helper methods there.</p><ul id="426ab9ac-2c48-4392-8f40-bc71e286a052" class="bulleted-list"><li style="list-style-type:disc">When performing Unit Tests, in Compose, it is possible to add a <code>Modifier</code> parameter, <code>testTag(String)</code> to assess if the component is visible or not</li></ul><ul id="e07dffda-a741-4d48-8651-df4336cae828" class="bulleted-list"><li style="list-style-type:disc">Note:<ul id="0eaef3a3-a613-42b8-a92f-3af99bdc9fc1" class="bulleted-list"><li style="list-style-type:circle">to access an empty activity, the test code uses the ComponentActivity instead of the main activity:<ul id="1465ef8d-1950-4b61-aa62-a6e285299fe8" class="bulleted-list"><li style="list-style-type:square"><code>@get:Rule</code><ul id="d9d773c4-9845-491a-b618-92ee01e7836b" class="bulleted-list"><li style="list-style-type:disc"><code>val composeTestRule = createAndroidComposeRule&lt;ComponentActivity&gt;()</code></li></ul></li></ul></li></ul></li></ul><ul id="10bfa591-ffc0-407f-a0b0-b8e073f20266" class="bulleted-list"><li style="list-style-type:disc">It is possible to create test annotations in order to only run certain tests on certain screen types<ul id="908dbec0-1318-4fad-807c-93a72ca44027" class="bulleted-list"><li style="list-style-type:circle">In order to run tests only on the compact devices:<ul id="3cba9b83-24fd-4fd3-8f03-7bd9c888b3b6" class="bulleted-list"><li style="list-style-type:square">create <code>TestAnnotation.kt</code> in the test directory<ul id="7eb5f7ca-e06a-4538-b36a-39140dcbc4ae" class="bulleted-list"><li style="list-style-type:disc">Create annotations such as compact<ul id="663e6b97-4e0b-4892-b14b-605608e7d8a3" class="bulleted-list"><li style="list-style-type:circle"><code>annotation class TestCompactWidth</code></li></ul></li></ul></li></ul><ul id="4bdc59d1-59cb-42f4-8954-3a0bd0335a01" class="bulleted-list"><li style="list-style-type:square">Annotate tests with said annotation, BELOW the <code>@Test</code> line</li></ul><ul id="8c2335c9-2dd8-4a4f-b403-fbbe80b7fde1" class="bulleted-list"><li style="list-style-type:square">Edit test run configuration<ul id="30f99d8a-76a3-4425-9734-ab6e51f096d2" class="bulleted-list"><li style="list-style-type:disc">Name the test</li></ul><ul id="ab417271-fdc2-4d3c-b3b6-320d3ad3d4c4" class="bulleted-list"><li style="list-style-type:disc">Test: All in Package</li></ul><ul id="52addf21-ceec-4c3e-9700-495d89b33111" class="bulleted-list"><li style="list-style-type:disc">Instrumentation Arguments: <code>com.example.app.test.TestCompactWidth</code></li></ul></li></ul></li></ul><ul id="737b8b97-e3ff-4dcc-80bc-d6fd5dd8d689" class="bulleted-list"><li style="list-style-type:circle">Run Test</li></ul></li></ul><h3 id="48167ff1-eda9-451c-aa69-d3f2d9737f51" class="">Instrumentation Tests</h3><p id="906eaa1f-fcf3-4557-8a21-3bd963910432" class="">Also known as UI tests, these launch an app on a physical Android or Android simulator and depend on platform API and services. In this case the test code is packaged in an APK that runs alongside the app APK</p><p id="5d424e36-7da0-454c-a0c0-75d17538f58d" class="">Setup is similar to the <code>onCreate()</code> method in <code>MainActivity.kt</code>:</p><pre id="d748997f-55cc-4917-972f-0ae352b7904a" class="code code-wrap"><code>packagecom.example.tiptime

importandroidx.compose.ui.test.junit4.createComposeRule
importcom.example.tiptime.ui.theme.TipTimeTheme
importorg.junit.Rule
importorg.junit.Test

classTipUITests {

@get:Rule
valcomposeTestRule = createComposeRule()

@Test
funcalculate_20_percent_tip() {
        composeTestRule.setContent {
            TipTimeTheme {
                TipTimeLayout()
            }
        }
    }
}</code></pre><p id="0e5cdfe1-a9e8-4791-a2aa-0f3f9adbce2d" class="">
</p><ul id="1298c717-c7ba-4b40-b861-c0fd48f8971e" class="bulleted-list"><li style="list-style-type:disc">use <code>onNodeWithText()</code> method to access the <code>TextField</code> Composables<pre id="db0ad789-f360-401e-ada3-2c95c7402d7d" class="code code-wrap"><code>composeTestRule
    .onNodeWithText(&quot;Bill Amount&quot;)
    .performTextInput(&quot;10&quot;)
composeTestRule
    .onNodeWithText(&quot;Tip Percentage&quot;)
    .performTextInput(&quot;20&quot;)</code></pre></li></ul><p id="b69c62f7-f71e-460c-9f65-24b0be0efc0e" class="">
</p><h3 id="c3edc775-a0ea-420d-8eb1-30a590ba860d" class="">Testing with fake data:</h3><ul id="fbc9bb40-dc6d-4f88-9fbc-a1e2de5c7a5c" class="bulleted-list"><li style="list-style-type:disc">First, implement all recommendations of a repository</li></ul><ul id="0afee73f-aaea-4f99-a2a6-6a9a9d503c78" class="bulleted-list"><li style="list-style-type:disc">create a local test directory: src / test / java</li></ul><ul id="9d04cb56-00d3-4cdb-abfc-aeba1d5493c2" class="bulleted-list"><li style="list-style-type:disc">create a new package in the test directory: <code>com.example.app</code></li></ul><ul id="c4bd0dce-f48a-428f-8b9b-532823f950c4" class="bulleted-list"><li style="list-style-type:disc">create a fake data source and a fake API, which calls the fake data source.</li></ul><ul id="8d770caa-4194-40c3-a389-d24f5d9c24de" class="bulleted-list"><li style="list-style-type:disc">Testing Coroutines:<ul id="a0b8b869-b58d-410e-9553-fd1f247b4330" class="bulleted-list"><li style="list-style-type:circle">In order to test functions that use a coroutine, we must launch the function from a coroutine scope. To do this in a test environment we can use the <code>runTest()</code> function.<ul id="0684f31e-4cf1-4ca9-8211-a8956577816a" class="bulleted-list"><li style="list-style-type:square"><code>@Test</code><p id="f6571aa5-a51f-407b-9d88-1c53ee340aae" class=""><code>fun networkMarsPhotosRepository_getMarsPhotos_verifyPhotoList() = runTest {</code><div class="indented"><p id="ad9c1cd3-f36d-4408-9951-fc16e29e9ea7" class=""><code>val repository = NetworkMarsPhotosRepository(</code><div class="indented"><p id="967d4e25-6d79-4ef6-9c3b-6c911f4df6ec" class=""><code>marsApiService = FakeMarsApiService()</code></p></div></p><p id="9164a627-6d1f-41b1-a901-db51cbad5d15" class=""><code>)</code></p><p id="a6ab2db8-484f-4e1e-a44f-80e6da1e1865" class=""><code>assertEquals(FakeDataSource.photosList, repository.getMarsPhotos())</code></p></div></p></li></ul></li></ul><ul id="828ce361-6e71-48ac-be6d-a671c65ee658" class="bulleted-list"><li style="list-style-type:circle">When testing a coroutine that uses the <code>Main</code> dispatcher, we must take extra steps as the main dispatcher is only available within Android when running a coroutine from a UI context. Instead, we will use the provided <code>TestDispatcher</code>.<ul id="c8acca0a-315c-4446-a63f-52015bf108d7" class="bulleted-list"><li style="list-style-type:square">To do this we will create a Test Rule to control the environment in which the test is run.</li></ul><ul id="d93f2a08-9cb6-4fc6-a4fe-cd471e197575" class="bulleted-list"><li style="list-style-type:square">Create a directory under <code>test.java.com.example.appname</code> called <code>rules</code></li></ul><ul id="666e1723-539f-47f7-ad45-3d572fea5231" class="bulleted-list"><li style="list-style-type:square">Create a class called <code>TestDispatcherRule</code> to extend the <code>TestWatcher</code> class<pre id="61721a6a-62c4-4f30-bb02-48d6ab668854" class="code"><code>class TestDispatcherRule(
    val testDispatcher: TestDispatcher = UnconfinedTestDispatcher(),
) : TestWatcher() {
    override fun starting(description: Description) {
        Dispatchers.setMain(testDispatcher)
    }

    @OptIn(ExperimentalCoroutinesApi::class)
    override fun finished(description: Description) {
        Dispatchers.resetMain()
    }
}</code></pre></li></ul><ul id="41948be3-4fe3-4d70-a2df-9decee2733c6" class="bulleted-list"><li style="list-style-type:square">Use this dispatcher in the unit test with the usage of the <code>Rule</code> functionality</li></ul><pre id="a5e8029f-59c9-496e-921c-46033e2551c9" class="code"><code>class MarsViewModelTest {

    @get:Rule
    val testDispatcher = TestDispatcherRule()

    @Test
    fun marsViewModel_getMarsPhotos_verifyMarsUiStateSuccess() = runTest {
        val marsViewModel = MarsViewModel(
            marsPhotosRepository = FakeNetworkMarsPhotosRepository()
        )
        assertEquals(
            MarsUiState.Success(
                &quot;Success: ${FakeDataSource.photosList.size} Mars &quot; +
                        &quot;photos retrieved&quot;
            ),
            marsViewModel.marsUiState
        )
    }

}</code></pre></li></ul></li></ul><figure id="fd816bc7-166d-482b-8d39-cd5d0ed0e8be" class="link-to-page"><a href="Android%20App%20Architecture%20a5b729d0f1634d16b92ea8f90c7a4034/App-Building%20Checklist%20fd816bc7166d482b8d39cd5d0ed0e8be.html">App-Building Checklist</a></figure><figure id="9cece365-b496-4ee1-926b-7543669bdd0b" class="link-to-page"><a href="Android%20App%20Architecture%20a5b729d0f1634d16b92ea8f90c7a4034/Android%20Fundamentals%209cece365b4964ee1926b7543669bdd0b.html">Android Fundamentals</a></figure><p id="3af90dd3-cf37-4832-a07b-744ac57a3c69" class="">
</p><h2 id="5f07082b-f9f7-46b8-a8c7-98d20b298238" class="">Adaptive Layouts</h2><p id="a8b5051a-fa1f-452e-844a-c174c46db06c" class="">In order to facilitate working with multiple layouts it is recommended to use multiple Preview Composables to show your app in multiple configurations and document to other developers that you are working with multiple layouts. This can be done by specifying both the <code>windowSize</code> in the <code>SomeApp</code> composable and setting the <code>widthDp</code> in the Preview Composable</p><h3 id="3535397d-e783-4ab5-9afb-a63560e4189b" class="">Breakpoints</h3><p id="9231482f-9954-4a03-aea4-433aff391c9d" class="">An app can show different layouts for different screen states on the one device by using conditionals on different states in order to determine how to best display the app’s information. The categorisation of which layout to use is based on pre-determined breakpoints as below.</p><figure id="21b6ff0d-8dd7-479e-888f-cbdb443c97b5" class="image"><a href="Android%20App%20Architecture%20a5b729d0f1634d16b92ea8f90c7a4034/Untitled%201.png"><img style="width:907px" src="Android%20App%20Architecture%20a5b729d0f1634d16b92ea8f90c7a4034/Untitled%201.png"/></a></figure><p id="d86a9f96-f264-403e-b28f-d8688a803bec" class="">The <code>WindowClassSize</code> API in compose introduces three categories of sizes for both width and height.</p><figure id="4e91546a-b075-414d-b42e-1394d9365a0e" class="image"><a href="Android%20App%20Architecture%20a5b729d0f1634d16b92ea8f90c7a4034/Untitled%202.png"><img style="width:744px" src="Android%20App%20Architecture%20a5b729d0f1634d16b92ea8f90c7a4034/Untitled%202.png"/></a></figure><p id="f19de8b4-979c-4ce9-8e9b-5d08540a99c1" class="">To implement <code>WindowClassSize</code>:<div class="indented"><ol type="1" id="5568a53f-1f11-47e8-a0b3-e880354bf514" class="numbered-list" start="1"><li>In <code>build.gradle.kts</code><p id="38065da6-d5c2-41b4-976a-9ec23078f8c6" class=""><code>dependencies {</code><div class="indented"><p id="ea1f6292-b485-4c10-8645-399eca48d8be" class=""><code>implementation(&quot;androidx.compose.material3:material3:material3-window-size-class&quot;)</code></p></div></p></li></ol><ol type="1" id="3a55b9e0-d4d7-47b8-baea-7ef4709e71df" class="numbered-list" start="2"><li>Sync Gradle</li></ol><ol type="1" id="794f0d04-1a51-466d-b5b0-1be984e6ee67" class="numbered-list" start="3"><li>Create a variable to store the size of the app’s window at any given time in <code>MainActivity.kt</code> and name the variable <code>windowSize</code><p id="230f08de-e342-4f99-8081-d44f0fab73d3" class=""><code>Surface {</code><div class="indented"><p id="b0f4eb77-80f9-4729-a03e-64b1c27b0d4b" class=""><code>val windowSize = calculateWindowSizeClass(this)</code></p></div></p></li></ol><ol type="1" id="c1442dd7-1faf-4ea6-b40b-ffd422409025" class="numbered-list" start="4"><li>Import the <code>calculateWindowSizeClass</code> package<p id="ae7d064a-21c4-4915-a902-6bd880e7465f" class=""><code>import androidx.compose.material3.windowsizeclass.calculateWindowSizeClass</code></p></li></ol><ol type="1" id="74903bf5-8b45-4638-ab76-41bdf30cd13e" class="numbered-list" start="5"><li>In the <code>SomeAppScreen.kt</code> file, modify the <code>SomeApp</code> Composable to accept the <code>WindowWidthSizeClass</code> and import the above mentioned package<p id="44f8964a-98ff-48eb-9996-45af7310d40f" class=""><code>@Composable</code></p><p id="59c67157-f919-4b2f-bdf8-de56ae20968a" class=""><code>fun SomeApp(</code><div class="indented"><p id="637c05f5-4154-417a-a5e9-c984955390b8" class=""><code>windowSize: WondowWidthSizeClass,</code></p><p id="415c515e-e9cb-4a6d-a408-06337577081f" class=""><code>modifier: Modifier = Modifier</code></p></div></p><p id="1595e67b-6d39-4c91-9e0f-ca26d1ba6263" class=""><code>) {}</code></p></li></ol><ol type="1" id="5cf3d5b0-2b23-4197-b214-ae615147c469" class="numbered-list" start="6"><li>Pass the <code>windowSize</code> variable to the <code>SomeApp</code> composable in the <code>MainActivity.kt</code>&#x27;s <code>onCreate()</code></li></ol><ol type="1" id="f9e990a3-1ea2-468d-a620-f8bd7f823f2e" class="numbered-list" start="7"><li>Update the Preview Composable to the desired preview example<p id="193bb4be-9d1a-4539-b408-b0f11182276e" class=""><code>windowSize = WindowWidthSizeClass.Compact</code></p></li></ol><ol type="1" id="222a8e12-7193-4c2e-a675-a4c3c87ceb9d" class="numbered-list" start="8"><li>To change the app layout based on the size of the screen, add a <code>when</code> statement in the <code>SomeApp</code> Composable based on the <code>WindowWidthSizeClass</code></li></ol><ol type="1" id="f4360f7d-6288-42e3-8301-cbfc6897fad4" class="numbered-list" start="9"><li>Consider the way in which the app should be displayed on each class of screen and adapt the layout accordingly. For example:<figure id="a996c9ee-7911-4ae0-b5af-7c7d94831c1c" class="image"><a href="Android%20App%20Architecture%20a5b729d0f1634d16b92ea8f90c7a4034/Untitled%203.png"><img style="width:500px" src="Android%20App%20Architecture%20a5b729d0f1634d16b92ea8f90c7a4034/Untitled%203.png"/></a></figure></li></ol><ol type="1" id="6cdde287-babf-41d4-b908-5d3daa8c0c26" class="numbered-list" start="10"><li>Set up an <code>Enum</code> class to represent the different fields required for each element. It is recommended to put this in a new package “utils” within the “ui” directory, naming the file something like <code>WindowStateUtils.kt</code><p id="3ede1b23-db9d-4933-9cb5-6c1a6197541a" class=""><code>enum class AppNavigationType { BOTTOM_NAVIGATION, NAVIGATION_RAIL, PERMANENT_NAVIGATION_DRAWER }</code></p></li></ol><ol type="1" id="46d70a1c-b2aa-4b1c-b84e-33a533f35f4e" class="numbered-list" start="11"><li>In the <code>SomeApp</code> composable, use the <code>when</code> statement to link the window size with the corresponding <code>enum</code><p id="0b755402-78be-4cf7-b75a-aaa6a634b78a" class=""><code>val navigationType: AppNavigationType = when (windowSize) { [options] }</code></p></li></ol><ol type="1" id="c3ab1709-d64b-43e4-9c02-ffa0cc609225" class="numbered-list" start="12"><li>In each screen, add the <code>navigationType</code> to the composable and configure the screen as needed.<p id="1ba091e4-6612-45a4-86dd-3ed03d32e941" class="">Consider passing the screen orientation to the app if needed:<div class="indented"><p id="286a5ea9-8cdc-4d4e-86f6-fc3239b73c21" class=""><code>LocalConfiguration.current.orientation: Configuration</code></p></div></p></li></ol></div></p><h3 id="60404da3-3792-498b-9ba2-53b4a6c93ccf" class="">Canonical Layouts</h3><p id="7324b09d-e303-4a71-a2f6-2b25904b6b5c" class="">This helps to avoid simply stretching content as it would be shown in a portrait device, in order to make the most of a landscape orientation. Canonical layouts can be broken down into the categories of app, list-view, supporting panel and feed.</p><h3 id="09ee6fd1-62d5-4c91-9cdc-714eb2381eb1" class="">Large Screen Readiness</h3><ul id="ddaa8995-b268-4bb4-b071-d69ca8dbb8bc" class="bulleted-list"><li style="list-style-type:disc">Review the Large screen app quality guidelines<ul id="9e31325a-58ad-4fe9-8759-e5bc849d652b" class="bulleted-list"><li style="list-style-type:circle"><a href="https://developer.android.com/docs/quality-guidelines/large-screen-app-quality">https://developer.android.com/docs/quality-guidelines/large-screen-app-quality</a></li></ul></li></ul><ul id="29fca5be-cf93-4674-8ff7-81177bebc4b6" class="bulleted-list"><li style="list-style-type:disc">Review the Tier 3 - Large screen ready requirements<ul id="8b4b537f-86cb-4866-a5cb-b5a70e0387c6" class="bulleted-list"><li style="list-style-type:circle"><a href="https://developer.android.com/docs/quality-guidelines/large-screen-app-quality#large_screen_ready">https://developer.android.com/docs/quality-guidelines/large-screen-app-quality#large_screen_ready</a></li></ul></li></ul><p id="2ca0ce7a-0c5f-41d3-b08a-42f4890fe862" class="">
</p><h2 id="bd86ef9d-4c6d-4fca-af36-02bbdd425995" class="">REST</h2><p id="009b294e-49e0-45d4-a9d8-aa76fb5edc5a" class="">Representationial State Transfer</p><ul id="0bd9eba8-e57b-4186-a920-909f9bb41935" class="bulleted-list"><li style="list-style-type:disc">Must Have:<ul id="2458d14c-0bec-4fda-ab5d-60ba31274677" class="bulleted-list"><li style="list-style-type:circle">Client-server architecture</li></ul><ul id="1505a47b-cb6e-465b-9b4b-00a048d807cd" class="bulleted-list"><li style="list-style-type:circle">Resources exposed as URIs (Uniform Resource Identifiers)</li></ul><ul id="d263a179-e0c2-4214-b4fa-a6d4c09775a9" class="bulleted-list"><li style="list-style-type:circle">Uniform Interface</li></ul><ul id="746e364d-05f9-40a9-9b78-ff31db71861d" class="bulleted-list"><li style="list-style-type:circle">Stateless</li></ul></li></ul><ul id="f51a2bcd-0206-492e-a7d7-53d899c5fe1c" class="bulleted-list"><li style="list-style-type:disc">Responds using XML or JSON<ul id="a700660e-e3b0-476c-8219-aa79217b7248" class="bulleted-list"><li style="list-style-type:circle">JavaScript Object Notation</li></ul><ul id="63939527-7c0e-4ebc-8409-68e9bf554ade" class="bulleted-list"><li style="list-style-type:circle">Structured data in key-value pairs:<ul id="eaeca01d-b685-4e1c-aadd-ae3f28dafa11" class="bulleted-list"><li style="list-style-type:square">key-value is separated by a colon</li></ul><ul id="8766baed-0f3f-42cb-bd18-9b744752afda" class="bulleted-list"><li style="list-style-type:square">pairs are separated by a comma</li></ul><ul id="f57d07c8-98cc-4c00-882f-4ba4119250ca" class="bulleted-list"><li style="list-style-type:square">names are surrounded by quotes</li></ul><ul id="3fd98996-14e5-40e8-9afa-15addaa47d6b" class="bulleted-list"><li style="list-style-type:square">values can be numbers, strings, booleans, arrays, objects or null</li></ul></li></ul><ul id="39105b2d-4ca2-4f1e-951f-e6bcb339deb0" class="bulleted-list"><li style="list-style-type:circle"></li></ul></li></ul><ul id="614bdffa-fd78-4ed0-80e3-da2e04b3911c" class="bulleted-list"><li style="list-style-type:disc">Data can be requested via a coroutine using <code>viewModelScope</code> which is a scope defined for each view model in the app. Therefore, any coroutine launched in the scope is cancelled if the view model is cleared, and the request can go on without interrupting the main thread, and will maintain its data through configuration changes</li></ul><p id="e7ef14ec-0fde-4ceb-b29c-bce2ed934b22" class="">
</p><h3 id="988b7b2b-edb0-4452-82a5-1969a1baf08a" class="">Retrofit Library</h3><ul id="65ffa2dd-5f8a-4920-bb90-24d41bb295d0" class="bulleted-list"><li style="list-style-type:disc">Dependencies (module-level):<ul id="b9d4f568-cbef-46ad-998e-ed6749945f64" class="bulleted-list"><li style="list-style-type:circle">Retrofit:<ul id="247975d5-547d-4682-ba3a-ddd697f53608" class="bulleted-list"><li style="list-style-type:square"><code>implementation &quot;com.squareup.retrofit2:retrofit:2.9.0&quot;</code></li></ul></li></ul><ul id="78efb5bd-eb50-403d-b2f8-35b38cde9d07" class="bulleted-list"><li style="list-style-type:circle">Retrofit with Scalar Converter<ul id="fc99fc6c-7dac-4e81-85d6-07184b949b6c" class="bulleted-list"><li style="list-style-type:square"><code>implementation &quot;com.squareup.retrofit2:converter-scalars:2.9.0&quot;</code></li></ul></li></ul></li></ul><p id="18019132-8b1d-404b-b61f-ac066b3c9c87" class="">
</p><h3 id="3cdb300b-c99f-4bdc-b5a6-69ebd18cb327" class="">Kotlin Serialization Converter</h3><p id="91e95ef4-9ec0-4648-9475-d0ce57218d41" class="">Serialisation is the process of converting data into a format that can be transferred over the internet, such as converting a host of images to a a JSON string. Deserialisation is the process of reading data from an external source and converting it to a runtime object.</p><p id="a15ca688-fc00-41b9-ab05-2f96c6f09462" class="">The Kotlin Serialisation Converter is a third party library that can be used to parse the JSON response from a RESTful server into useful Kotlin objects.</p><ul id="b96f4d29-0427-4bcf-b07d-968d7e405e58" class="bulleted-list"><li style="list-style-type:disc">Dependencies (Module: app)<ul id="8291993d-2f07-499e-a4a6-b6503902c1a6" class="bulleted-list"><li style="list-style-type:circle"><code>plugins {</code><ul id="5097db6f-2227-4f9a-b670-ed28bd27eae8" class="bulleted-list"><li style="list-style-type:square"><code>id &#x27;org.jetbrains.kotlin.plugin.serialization&#x27; version &#x27;1.8.10&#x27;</code></li></ul></li></ul><ul id="577986d0-4a87-4363-a73a-c2a4395829b4" class="bulleted-list"><li style="list-style-type:circle"><code>dependencies {</code><ul id="f0ec50c0-9a48-40b9-b221-cf342becf5ed" class="bulleted-list"><li style="list-style-type:square"><code>implementation &quot;org.jetbrains.kotlinx:kotlinx-serialization-json:1.5.1&quot;</code></li></ul></li></ul></li></ul><h2 id="b4c35b3d-222a-456d-979c-2dfb141b1d92" class="">Permissions</h2><p id="ff9a7e3a-6e49-46cb-97ef-85296bebd607" class="">Defined in manifests/AndroidManifest.xml</p><ul id="00cf1693-bc0e-4548-91ba-b06e88b84ea0" class="bulleted-list"><li style="list-style-type:disc">Underneath manifest, before application:<ul id="4d5ab911-68da-4a53-913d-1c401dc16539" class="bulleted-list"><li style="list-style-type:circle"><code>&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</code></li></ul></li></ul><p id="58078383-9458-4a76-b97c-1f39789f7d06" class="">
</p><h3 id="af8096fe-ee74-4459-a02c-2961a7dc4170" class="">Retrofit Step-By-Step</h3><ul id="56bb6311-99bb-44aa-b407-6a65417ce13f" class="bulleted-list"><li style="list-style-type:disc">Add Retrofit dependencies<pre id="9582e85d-bb5e-48e9-8a27-a9e7b217fae1" class="code code-wrap"><code>// Retrofit
implementation &quot;com.squareup.retrofit2:retrofit:2.9.0&quot;
// Retrofit with Scalar Converter
implementation &quot;com.squareup.retrofit2:converter-scalars:2.9.0&quot;</code></pre></li></ul><ul id="05bfd6ed-7872-4321-a383-9f2497485621" class="bulleted-list"><li style="list-style-type:disc">Create Retrofit API data source class<ul id="06b2daa1-fd20-4eb9-bd4c-885c64d2b699" class="bulleted-list"><li style="list-style-type:circle">under package “network”, named AppNameApiService</li></ul><ul id="cfbe74a9-f753-45c3-9e3f-c09f8a72f1b1" class="bulleted-list"><li style="list-style-type:circle"><code>private const val BASE_URL = &quot;[URI]&quot;</code></li></ul></li></ul><ul id="39bb3207-51ca-4cda-8a24-c49dcdff5d11" class="bulleted-list"><li style="list-style-type:disc">Create a retrofit object, with Scalars Converter Factory, using the base URL:<pre id="57d42ba9-b9d7-48a9-88de-1fd8fd7c6bfc" class="code code-wrap"><code>private val retrofit = Retrofit.Builder()
    .addConverterFactory(ScalarsConverterFactory.create())
    .baseUrl(BASE_URL)
    .build()</code></pre></li></ul><ul id="e3902b2c-3ad2-4554-90aa-2dcf0efe255a" class="bulleted-list"><li style="list-style-type:disc">Create Interface to determine how retrofit talks to server<ul id="8db17f4f-659a-4831-94fc-5b57d7363887" class="bulleted-list"><li style="list-style-type:circle">define HTTP functions (GET, POST, PUT, DELETE), using annotations for Retrofit</li></ul><ul id="ada72dbb-b170-4f81-af83-6406143a7ba0" class="bulleted-list"><li style="list-style-type:circle"><code>interface AppApiService {</code><ul id="19b2a6b9-f5ba-4550-8493-7f13713740e8" class="bulleted-list"><li style="list-style-type:square"><code>@GET (&quot;object&quot;)</code></li></ul><ul id="7595e79a-04b5-484e-8037-c563119ddce2" class="bulleted-list"><li style="list-style-type:square"><code>suspend fun getObject(): Type</code></li></ul></li></ul><ul id="dfbdaaa0-c3ec-47c0-b9bd-7f697c1a4fc4" class="bulleted-list"><li style="list-style-type:circle">When “getObject” is invoked, Retrofit appends the endpoint “object” to the base URL, which was earlier defined</li></ul></li></ul><ul id="eae1aec4-581f-469b-b614-656a7086f635" class="bulleted-list"><li style="list-style-type:disc">Create retrofit service and expose instance to the API service to the rest of the app<ul id="327843d6-93d6-4143-b335-44e28aeee831" class="bulleted-list"><li style="list-style-type:circle">Creating a retrofit service is expensive and thus should only be done once, and then this object can be exposed to the rest of the app.</li></ul><ul id="f5e4d51e-0733-4c8a-9d65-42cc7aab0ca9" class="bulleted-list"><li style="list-style-type:circle">The use of lazy ensures that the object is not created on instantiation but is instead created the first time that it is needed.</li></ul><ul id="37808397-f9ac-49b1-a90a-0725e4a05792" class="bulleted-list"><li style="list-style-type:circle"><code>object AppApi {</code><ul id="74ed533c-4ed1-457d-bf34-0151d4d0d2be" class="bulleted-list"><li style="list-style-type:square"><code>val retrofitService: AppApiService by lazy {</code><ul id="0cb75fef-6998-4c5b-a6dd-8988a9c8a7c1" class="bulleted-list"><li style="list-style-type:disc"><code>retrofit.create(AppApiService::class.java)</code></li></ul></li></ul></li></ul></li></ul><ul id="dc7486e4-0ff4-4fcd-81a5-8b9e92bda9bf" class="bulleted-list"><li style="list-style-type:disc">Call the web service in (View Model) Repository<ul id="fde935ba-5226-4241-a3d3-4183c35db493" class="bulleted-list"><li style="list-style-type:circle">Initially called from the view model, it is best practice to call the service from the Repository inside the Data Layer, in order to isolate the data layer from the rest of the app.</li></ul><ul id="b0b2b4d1-81cf-4074-b2b8-4328097d8145" class="bulleted-list"><li style="list-style-type:circle">It is possible to use View Model as this will ensure data remains despite configuration changes, and that a coroutine launched in this scope is automatically cancelled if the ViewModel is cleared.</li></ul><ul id="fc0b3817-c125-43b8-8f25-4adeee361b80" class="bulleted-list"><li style="list-style-type:circle"><code>fun getObject() {</code><ul id="f12602f4-6bca-4d46-817b-35cd6ddae990" class="bulleted-list"><li style="list-style-type:square"><code>viewModelScope.launch { appUiState = AppApi.retrofitService.getObject() }</code></li></ul></li></ul></li></ul><ul id="2e080c11-6751-42bb-8d67-8010f96ac58f" class="bulleted-list"><li style="list-style-type:disc">Enable internet permissions<ul id="57186e3a-e26b-4e0e-b1d0-ebfb5cb6e834" class="bulleted-list"><li style="list-style-type:circle">in <code>manifests/AndroidManifest.xml</code><ul id="0ad45e11-1e59-40da-9ce1-cd57651be2a5" class="bulleted-list"><li style="list-style-type:square">Above <code>&lt;application</code></li></ul><ul id="b1e7476e-5fc1-49a1-9c30-a91a004bb5fe" class="bulleted-list"><li style="list-style-type:square"><code>&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</code></li></ul></li></ul></li></ul><ul id="71e4e071-7bb3-4c16-9f82-f63b938ee95c" class="bulleted-list"><li style="list-style-type:disc">Exception Handling with Sealed Interface<ul id="6b10175f-6dd0-4852-becc-4b92fbbc7528" class="bulleted-list"><li style="list-style-type:circle">In order to handle exceptions such as an inability to connect to or successfully interact with the server, a try-catch block can be implemented along with a sealed interface defining the possible outcomes of server interaction.</li></ul><ul id="566808d8-deaa-4534-8963-c9a27ba5eae5" class="bulleted-list"><li style="list-style-type:circle">Create a specific list of outcomes, with one storing the desired values:</li></ul><pre id="3e5c0cf4-0cee-4850-9d08-e4723d09f54c" class="code code-wrap"><code>sealed interface MarsUiState {
    data class Success(val photos: String) : MarsUiState
    object Error : MarsUiState
    object Loading : MarsUiState
}</code></pre><ul id="915aa647-a12c-4cd6-a07f-fbc3b864bc5a" class="bulleted-list"><li style="list-style-type:circle">Create a mutableStateOf to store this data class OR error state:<ul id="f6455414-be49-48e4-b445-1690a4779882" class="bulleted-list"><li style="list-style-type:square"><code>var marsUiState: MarsUiState by mutableStateOf(MarsUiState.Loading)</code><ul id="94fa0b67-bd38-4979-9cff-bcd68c1ab2c1" class="bulleted-list"><li style="list-style-type:disc"><code>private set</code></li></ul></li></ul><ul id="6c389b7d-2e2b-433a-9850-27c82edd1228" class="bulleted-list"><li style="list-style-type:square">private set protects writes to the variable</li></ul></li></ul><ul id="15244c0b-f769-4eba-a3c2-44f6d89322e8" class="bulleted-list"><li style="list-style-type:circle">Update the GET function to try to get, returning success with value if successful, error state if not successful:</li></ul><pre id="d337ca88-c1b2-43fa-9784-0394e1934a22" class="code"><code>fun getMarsPhotos() {
    viewModelScope.launch {
        marsUiState = try {
            val listResult = MarsApi.retrofitService.getPhotos()
            MarsUiState.Success(listResult)
        } catch (e: IOException) {
             MarsUiState.Error
        }
    }
}</code></pre><ul id="24ab57a9-a907-4907-b5a4-2f277da08f6d" class="bulleted-list"><li style="list-style-type:circle">Use a when statement within a Composable in order to change state depending on the current status of the interaction with the server:</li></ul><pre id="b73ed798-fb14-4865-89a4-75adf258c30b" class="code"><code>when (marsUiState) {
    is MarsUiState.Loading -&gt; LoadingScreen(modifier = modifier.fillMaxSize())
    is MarsUiState.Error -&gt; ErrorScreen(modifier = modifier.fillMaxSize())
    is MarsUiState.Success -&gt; ResultScreen(
        marsUiState.photos,
        modifier = modifier.fillMaxWidth()
    )
}</code></pre></li></ul><ul id="b122963e-8eb7-4c86-8ea4-89a544b3226c" class="bulleted-list"><li style="list-style-type:disc">Serialisation:<ul id="a1527e11-49cd-416a-86f8-0ea0840bf946" class="bulleted-list"><li style="list-style-type:circle">Add kotlin serialisation library dependencies:<ul id="b8fa1098-e59b-4924-8947-99485568aa7f" class="bulleted-list"><li style="list-style-type:square">in build.gradle app module:<ul id="254a9e8d-ea65-4814-b4cb-70b2dbf1e526" class="bulleted-list"><li style="list-style-type:disc">under plugins<ul id="90f65581-363e-4993-b9c4-a0b8ce984123" class="bulleted-list"><li style="list-style-type:circle"><code>id &#x27;org.jetbrains.kotlin.plugin.serialization&#x27; version &#x27;1.8.10&#x27;</code></li></ul></li></ul><ul id="6062aece-1144-4313-93bf-76801ef91b4f" class="bulleted-list"><li style="list-style-type:disc">under dependencies<ul id="3105b789-8edd-4745-8041-29972570b1d7" class="bulleted-list"><li style="list-style-type:circle"><code>implementation &quot;org.jetbrains.kotlinx:kotlinx-serialization-json:1.4.0&quot;</code></li></ul></li></ul><ul id="8c63c223-b40b-4f8f-9234-352374f5fed8" class="bulleted-list"><li style="list-style-type:disc">replace Scalar Converter with<pre id="c011a06f-91ab-41fd-b6d9-6bff78e6ee7f" class="code code-wrap"><code>// Retrofit with Kotlin serialization Converter
implementation &quot;com.jakewharton.retrofit:retrofit2-kotlinx-serialization-converter:0.8.0&quot;
implementation &quot;com.squareup.okhttp3:okhttp:4.10.0&quot;</code></pre></li></ul></li></ul></li></ul><ul id="ced06f67-8e41-4f6f-9877-2109323b4788" class="bulleted-list"><li style="list-style-type:circle">Create data class for downloaded resources and mark with serializable, defining key names if different in JSON than in the code base<pre id="c542b00e-8624-43ca-837f-3ca1feac2510" class="code code-wrap"><code>@Serializable
data class MarsPhoto(
	valid: String,
	@SerialName(value = &quot;img_src&quot;)
	valimgSrc: String
)</code></pre></li></ul><ul id="474d554c-3823-4336-b9a9-c2f63e49149b" class="bulleted-list"><li style="list-style-type:circle">Change from Scalar to Kotlin Serialisation in ViewModel<ul id="7f1bf610-552e-41ae-9416-ad43c800b946" class="bulleted-list"><li style="list-style-type:square"><code>.addConverterFactory(Json.asConverterFactory(&quot;application/json&quot;.toMediaType()))</code></li></ul></li></ul></li></ul><p id="86523ab7-2ecb-4632-93a3-42410162342c" class="">
</p><p id="5ba3d842-b1fe-47cc-b1d2-5ceebb6e46e8" class="">
</p><h2 id="d7c64a89-7158-45ba-bddd-17e109295dbc" class="">Data Layer</h2><p id="95739e05-4b95-4a6f-b5cf-ad2b70d4c7ca" class="">While it is possible to get data from a web service by having the <code>ViewModel</code> retrieve the URL, this is not the recommended as it does not scale well or work well with different data sources. It is therefore recommended to implement a separation between the data layer and UI.</p><p id="c152e559-27b4-48e7-b0ec-ae535be0b932" class="">The data layer is responsible for the business logic of the app and for sourcing and saving data for the app. The data layer exposes data to the UI layer using Unidirectional Data Flow. The data layer is also responsible for resolving conflicts between differing data sources.</p><p id="2845e972-47fc-4c43-bb99-c6dd7bc069c9" class="">Having data in a separate layer from the UI follows the principle of Separation of Concerns and allows you to make changes in one part of the code without affecting another.</p><p id="bb3deecb-f164-4871-97b3-a2566bfd52df" class="">The data layer is made up of one or more repositories, each containing zero or more data sources. It is best practice for each type of data source to have its own repository.</p><figure id="f6186cfe-c1cf-4a23-a3e6-26b4ad692b92" class="image"><a href="Android%20App%20Architecture%20a5b729d0f1634d16b92ea8f90c7a4034/Untitled%204.png"><img style="width:373px" src="Android%20App%20Architecture%20a5b729d0f1634d16b92ea8f90c7a4034/Untitled%204.png"/></a></figure><p id="42714f70-dd4d-4e5f-a3d6-7b1e396acb7f" class="">In general, the repository class:</p><ul id="2a679bb3-df68-491a-bfed-2303605b5bf3" class="bulleted-list"><li style="list-style-type:disc">Exposes data to the rest of the app</li></ul><ul id="056eba88-955f-4bfa-b373-d859bf6c2dbe" class="bulleted-list"><li style="list-style-type:disc">Centralises changes to data</li></ul><ul id="229a19d5-affd-49a5-bc9e-b50e7cf56200" class="bulleted-list"><li style="list-style-type:disc">Resolves conflicts between multiple data sources</li></ul><ul id="1bdc5b61-5167-4a72-91d6-9094d6296a21" class="bulleted-list"><li style="list-style-type:disc">Abstracts sources of data from the rest of the app</li></ul><ul id="53ef825e-d1db-48a6-97f9-7df56d17d8a8" class="bulleted-list"><li style="list-style-type:disc">Contains business logic</li></ul><p id="fa2f9766-4b06-4fe7-b05a-ffeeced9c4da" class="">Convention dictates that the repositories are named: <code>[type of data] + Repository</code> and should be placed in the <code>data</code> package.</p><ul id="cce651cf-efa2-4a7f-943c-ebee8db14f96" class="bulleted-list"><li style="list-style-type:disc">Create an interface of the repository type<ul id="46432a7d-fe3c-4b68-8713-3668125432e9" class="bulleted-list"><li style="list-style-type:circle"><code>interface MarsPhotoRepository {</code><ul id="e5ee21fa-8ab3-495c-9f89-25cfe3220a01" class="bulleted-list"><li style="list-style-type:square"><code>suspend fun getMarsPhotos() : List&lt;MarsPhotos&gt;</code></li></ul></li></ul></li></ul><ul id="5a758210-7035-4b49-a8db-f72d451ae74f" class="bulleted-list"><li style="list-style-type:disc">Below the interface declaration, create a class named Network___ for implementing the interface and override the abstract function</li></ul><pre id="82b81692-30d2-44db-bf52-b2efb3899bc2" class="code code-wrap"><code>class NetworkMarsPhotosRepository() : MarsPhotoRepository {
	override suspend fun getMarsPhotos(): List&lt;MarsPhoto&gt; {
		return MarsApi.retrofitService.getPhotos()</code></pre><ul id="76568e1e-2eb9-4f55-bbf6-9272f661ebef" class="bulleted-list"><li style="list-style-type:disc"></li></ul><p id="c68783e8-6a82-4bcb-a46a-154ab01d4273" class="">
</p><p id="4b879984-c4f7-4135-8e1f-bbdc9c4c649c" class="">
</p><h3 id="e9c732b0-8f55-4640-8191-1cf5eca8eb92" class="">Dependency Injection</h3><p id="fc3e2bb6-132a-47bc-9d14-f89fe4c9c8c9" class="">Dependency Injection is when dependency is provided at runtime instead of being hardcoded into the calling class.</p><p id="fb9661a4-c8c6-47fa-bf7e-b95659bad90a" class="">Often, classes require other objects of other classes in order to function. When a class requires another class, the required class is referred to as a dependency. One way is for one class to instantiate another class however this is inflexible and difficult to test. Preferable is for the calling class to be instantiated with an already instantiated object, by receiving it as a parameter. This decouples the two classes for greater flexibility and is referred to as “dependency Injection” or “inversion of control”. This helps in a number of ways including:<div class="indented"><ol type="1" id="49fd6532-b51d-4707-a87d-e87f6c1ee8e5" class="numbered-list" start="1"><li>Code Reusability - code is not dependent on a specific object for greater flexibility</li></ol><ol type="1" id="ef3e1923-2cc8-4cee-a30f-baecf2d40e90" class="numbered-list" start="2"><li>Easier Refactoring - calling code does not need to be changed when objects change</li></ol><ol type="1" id="9b679228-b49f-47d1-8701-066bd081861e" class="numbered-list" start="3"><li>Testing Simplicity - test objects can be passed in for testing purposes</li></ol></div></p><p id="a3ac622d-bb44-4a27-8cd5-8af5d03b0ac4" class="">One example of DI that can help with testing is that of a real Vs a fake network service. The fake network service can be used to provide dummy data that can be tested where the production version of the app will instead use a real network service. In order to do this we will create an application container. A container is an object that contains all the dependencies that the app requires. In this case we can use one (fake) container for testing and another (real) container for production.</p><p id="1e4d2968-d099-40a1-87aa-77825209cac1" class="">Creating an Application Container:</p><ul id="ab8973f6-928c-4c7a-9d84-fa0f56fbb2f6" class="bulleted-list"><li style="list-style-type:disc">within the data package, create a new Kotlin file: AppContainer</li></ul><ul id="5596c9a2-2596-4ce9-95d3-46fd915fc0d1" class="bulleted-list"><li style="list-style-type:disc">Ensure all data collection / setup is contained within this container, as was previously the case with the API Service. The API Service will remain as an interface.</li></ul><ul id="7866e461-7837-4c59-9e75-3b615bd7592e" class="bulleted-list"><li style="list-style-type:disc">In the photo repository, update the class to accept the marsApiService</li></ul><ul id="a337a02a-2ae3-46cc-ad42-139618e5a67c" class="bulleted-list"><li style="list-style-type:disc">Create a top-level AppApplication.kt Class, extending from <code>Application()</code>, which will allow us to pass the appropriate container<ul id="8b7ee211-1df4-4e2f-8527-c9b2ab5a4ab9" class="bulleted-list"><li style="list-style-type:circle"><code>class AppApplication : Application() {</code><ul id="f01bc5df-1e10-42af-96ef-42aa9876b207" class="bulleted-list"><li style="list-style-type:square"><code>lateinit var container: AppContainer</code></li></ul><ul id="37e00127-cf1f-483f-a7bd-9c4e2a2bcc79" class="bulleted-list"><li style="list-style-type:square"><code>override fun onCreate() {</code><ul id="94039908-eee0-4475-8292-125b71e2e6e2" class="bulleted-list"><li style="list-style-type:disc"><code>super.onCreate()</code></li></ul><ul id="ea67c959-ef26-4a68-ad00-479d17ced593" class="bulleted-list"><li style="list-style-type:disc"><code>container = DefaultAppContainer()</code></li></ul></li></ul></li></ul></li></ul><ul id="ba50e3c9-87f3-4c94-bcc8-c19c1bb4e358" class="bulleted-list"><li style="list-style-type:disc">Update the Android manifest so that the app uses the application class just defined.<ul id="0f889f57-0d67-4199-a979-790e07b9a498" class="bulleted-list"><li style="list-style-type:circle"><code>&lt;application</code><ul id="6ef222c8-83ce-42d8-a72e-634b63e76dc9" class="bulleted-list"><li style="list-style-type:square"><code>andoid:name=&quot;.AppApplication&quot;</code></li></ul></li></ul></li></ul><ul id="9c03c625-cb99-4b54-a9cf-d716937594d4" class="bulleted-list"><li style="list-style-type:disc">Once done, the view model can call the repository object to retrieve app data<ul id="84513b0c-9c3c-4229-bf56-4167b96f593c" class="bulleted-list"><li style="list-style-type:circle">Add a constructor parameter to the view model:<ul id="e1dfc9fc-67dd-409f-bf41-2020cdff0912" class="bulleted-list"><li style="list-style-type:square"><code>class MarsViewModel(private val marsPhotosRepository: MarsPhotosRepository) : ViewModel() {</code></li></ul><ul id="ea0f8df1-4954-4bb1-90f6-5647634b4d3a" class="bulleted-list"><li style="list-style-type:square">Note that the Android framework does NOT allow a <code>ViewModel</code> to be passed values in the constructor when created. Thus, we create a <code>ViewModelProvider.Factory</code> object in order to get around this limitation</li></ul><ul id="538286ca-9bb4-4a28-8d88-0dfdcc570538" class="bulleted-list"><li style="list-style-type:square">Create a companion object to passin the values from the constructor</li></ul><pre id="3719852d-b313-4057-b270-99e5dd0c89e6" class="code"><code>companion object {
    val Factory : ViewModelProvider.Factory = viewModelFactory {
        initializer {
            val application = (this[APPLICATION_KEY] as MarsPhotosApplication)
            val marsPhotosRepository = application.container.marsPhotosRepository
            MarsViewModel(marsPhotosRepository = marsPhotosRepository)
        }
    }
}</code></pre></li></ul></li></ul><p id="b431833e-de5c-4178-a259-c9219f465da5" class="">
</p><h2 id="76cf0d99-17a0-4879-b0af-3e03340f3bfe" class="">Creating a multi-screen adaptive repository app with testing</h2><ol type="1" id="5e1554fa-7fd8-4d38-8d92-3251cf210820" class="numbered-list" start="1"><li>Create Theme<ol type="a" id="abee8f01-0263-47e8-9733-a479d57edfa7" class="numbered-list" start="1"><li>Launcher Icon</li></ol><ol type="a" id="8f378b0b-d9dd-4b51-8ff5-513128576fdc" class="numbered-list" start="2"><li>Colors</li></ol><ol type="a" id="70d04e21-e0df-425f-9061-8a9ab5c151aa" class="numbered-list" start="3"><li>Typography</li></ol><ol type="a" id="badce12c-b4a9-4ef5-99c4-de0545c3abf5" class="numbered-list" start="4"><li>Shapes</li></ol></li></ol><ol type="1" id="026fe40a-2fb9-4b95-84dc-781cd19c0ab1" class="numbered-list" start="2"><li>Create Main Screen (ui)<ol type="a" id="ae52776d-24f9-4601-9408-9c58f8491b72" class="numbered-list" start="1"><li>Scaffold</li></ol><ol type="a" id="9034df45-cf8c-4ee9-ade1-5797f2e247ac" class="numbered-list" start="2"><li>Top app bar</li></ol><ol type="a" id="1800078a-824a-4312-aa43-474ff0cfd866" class="numbered-list" start="3"><li>Back navigation</li></ol></li></ol><p id="c456632a-892b-4d7f-8764-fa4bcd0a6fa0" class="">
</p><h2 id="33b2952d-e084-4154-ac41-0734e29e6994" class="">Creating a network-interfacing API with Data Layer</h2><ol type="1" id="164afae8-f5b5-42cc-aefa-6dca82cdf695" class="numbered-list" start="1"><li>Add dependencies to gradle:<ol type="a" id="c65a9683-21d0-436c-90cc-7c53cedb7f29" class="numbered-list" start="1"><li>Retrofit:<p id="bff7964e-49f6-48ac-a6bb-f15d15ec21e3" class=""><code>implementation &#x27;com.squareup.retrofit2:retrofit:2.9.0&#x27;</code></p></li></ol><ol type="a" id="c8c2faa0-bdc1-44eb-a173-e0b491a01afe" class="numbered-list" start="2"><li>Scalar Converter for Retrofit (to return JSON as a string):<p id="82d97028-599f-4e41-8a1a-2ce44b99a936" class=""><code>implementation &#x27;com.squareup.retrofit2:converter-scalars:2.9.0&#x27;</code></p></li></ol><ol type="a" id="621ce15a-ca51-47ea-831f-a21e053dcdc0" class="numbered-list" start="3"><li>Compose View Model:<p id="5a1ed480-b90c-45e3-9ba9-e9492b001242" class=""><code>implementation &#x27;androidx.lifecycle:lifecycle-viewmodel-compose:2.6.1&#x27;</code></p></li></ol></li></ol><ol type="1" id="45b3af90-6c62-4b49-9490-181ffac0f41a" class="numbered-list" start="2"><li>Add internet permission to Android Manifest.<ol type="a" id="e8cef847-9c1f-48ad-8631-606016a10bd9" class="numbered-list" start="1"><li>Below <code>manifest</code> but above <code>application</code><p id="7790ceab-ae36-4504-b3a6-24c85730cb47" class=""><code>&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</code></p></li></ol></li></ol><ol type="1" id="14558f6c-9125-4fd3-a103-20dcf932b4db" class="numbered-list" start="3"><li>Create a source for the app API<ol type="a" id="e4771dd6-eb8a-4dc5-8891-6543563ed027" class="numbered-list" start="1"><li>Create <code>AppApiService</code> in the <code>network</code> package</li></ol><ol type="a" id="bb304d76-cf8b-422f-b461-d09532db1018" class="numbered-list" start="2"><li>Add the constant for the base URL to be accessed<p id="b2915995-ef9c-421a-b68f-715da1bcfc44" class=""><code>private const val BASE_URL =</code><div class="indented"><p id="a6ee19a2-62d0-442d-ab69-b75099fa3946" class=""><code>&quot;https://.......com&quot;</code></p></div></p></li></ol><ol type="a" id="18a1f12e-72a1-4956-ae5e-d33215ddb5aa" class="numbered-list" start="3"><li>Add Retrofit builder to create retrofit object with scalar converter factory to tell retrofit what to do with the downloaded data from the web service. The object will also accept as input the base URL created above.<p id="82567a84-4406-42e7-bc49-43b8f80dd0ca" class="">* <code>import retrofit2.Retrofit</code></p><p id="9ba17daa-8d65-4ff8-ab95-5eed85122e23" class="">* <code>import retrofit2.converter.scalars.ScalarsConverterFactory</code></p><p id="726aacca-b1e1-4324-bb4c-b35fe4c706a0" class=""><code>private val retrofit = Retrofit.Builder()</code><div class="indented"><p id="83753cfb-9a4d-4c42-b76e-36a522662e37" class=""><code>.addConverterFactory(ScalarsConverterFactory.create())</code></p><p id="483b3215-6b17-4062-b7cd-f1a758ca293c" class=""><code>.baseUrl(BASE_URL)</code></p><p id="3098c7aa-d1a5-4730-a767-a05131c4905e" class=""><code>.build()</code></p></div></p></li></ol><ol type="a" id="df1dde24-be2d-4046-a2ad-fa1fa6d2a553" class="numbered-list" start="4"><li>Define the API interface with a function to access data from the network using a GET request. The endpoint is the section of the URL that comes after the base URL. Note that this is a suspended function.<p id="04401aa6-2762-4364-b1ad-50d2a0117d38" class="">* <code>import retrofit2.http.GET</code></p><p id="0a3f09fc-bb68-4a86-96a3-3612beb5689f" class=""><code>interface AppApiService {</code><div class="indented"><p id="3fea39f8-7792-4c38-add6-0022b56364ba" class=""><code>@GET(&quot;[endpoint]&quot;)</code></p><p id="2959f23a-af60-4f93-ab57-0f64ac1daa7f" class=""><code>suspend fun getData(): String</code></p></div></p></li></ol><ol type="a" id="f486aea7-3000-4191-8188-b6b3844b5aa2" class="numbered-list" start="5"><li><span style="border-bottom:0.05em solid">TEMPORARILY</span> create a singleton object to access this API. This singleton object will later be replaced with Dependency Injection but for the moment, this object can be used to ensure implementation functionality at this point. The object is created outside the interface declaration and is lazily implemented.<p id="318054e3-622a-43bf-b847-55240bf7559b" class=""><code>object AppApi {</code><div class="indented"><p id="a6367b34-d1e8-427b-bf65-516cbc31957f" class=""><code>val retrofitService : AppApiService by lazy {</code><div class="indented"><p id="59abadfb-9368-4bef-a5eb-fbe9d8f63057" class=""><code>retrofit.create(AppApiService::class.java)</code></p></div></p></div></p></li></ol></li></ol><ol type="1" id="081e8192-7236-468c-9694-f4bca095d723" class="numbered-list" start="4"><li><span style="border-bottom:0.05em solid">TEMPORARILY</span> use View Model to access the singleton object and run the suspend function within <code>viewModelScope</code>. This is to ensure that the response from the server is being received as expected.<ol type="a" id="7b0bed04-1a38-46f3-89eb-eddd061bd3d0" class="numbered-list" start="1"><li>Create a function within the view model to access the network API and return the result to the UI State<p id="41f16a6f-4c3b-49be-9a7d-9655892be1aa" class=""><code>private fun getData() {</code><div class="indented"><p id="f7096f2c-fc87-423b-9e78-90aeb5176065" class=""><code>viewModelScope.launch {</code><div class="indented"><p id="a44bfdb8-abf2-42fe-8af8-4e3386bca28e" class=""><code>val result = AppApi.retrofitService.getData()</code></p><p id="0aac9d55-2fec-4c2a-940f-1566e1c2b013" class=""><code>appUiState = result</code></p></div></p></div></p></li></ol></li></ol><ol type="1" id="b2c45190-5109-4a22-9d6a-cd235322989d" class="numbered-list" start="5"><li><strong>CHECK:</strong><ol type="a" id="6d480a5b-fbef-4ffe-bb91-28f2a6be220e" class="numbered-list" start="1"><li>Test the data being is pulled through the system successfully by calling the View Model’s App UI State result from another class<p id="1f4553d1-4bbe-4ca1-a86d-a966616f01d7" class=""><code>val viewModel: AppViewModel = viewModel()</code></p><p id="b89a4a98-35e7-48c8-b6b3-732c67bd61ad" class=""><code>val stringToDisplay = viewModel.appUiState</code></p><p id="f973abc5-66b3-49e4-ae70-7cb23316dd85" class=""><code>Text(stringToDisplay)</code></p></li></ol></li></ol><ol type="1" id="2dde1267-fff0-48fd-a149-cc18b05aa1db" class="numbered-list" start="6"><li>Define a sealed interface network UI state within View Model, passing in the successful result as a data class parameter or failed results as state objects<ol type="a" id="b497a55a-7242-4c33-994c-16cf260839c7" class="numbered-list" start="1"><li>Define network status with Success (values), Loading and Error states<p id="784bd3b0-95a0-4e5f-8141-93c55918a16b" class=""><code>sealed interface NetworkUiState {</code><div class="indented"><p id="ad39f5dd-1bd0-466a-aab0-05d93d077789" class=""><code>data class Success(val data: Type) : NetworkUiState</code></p><p id="967f5040-1b63-468e-b1a7-74dac14b7b50" class=""><code>object Error : NetworkUiState </code></p><p id="421b6153-46ff-4bcf-847f-41d3c476933b" class=""><code>object Loading : NetworkUiState</code></p></div></p></li></ol><ol type="a" id="ee4b14f2-ae65-404c-9dd5-ac75042be2a6" class="numbered-list" start="2"><li>Update the value of network UI State in the View Model to reflect the Network State with the default value of “Loading”<ol type="i" id="67583309-c691-415d-b2a1-b90eb1d24527" class="numbered-list" start="1"><li>note that the below red text is not currently working under this implementation - to be investigated later. For the moment, use:<ol type="1" id="1cd81787-ce44-4764-b578-e7d4ad7d130e" class="numbered-list" start="1"><li>This issue may have been solved: the MutableStateFlow pulls through all changes to NetworkUiState thus updating the composables. This is useful for testing purposes. The mutable state only updates composables when the value of the NetworkUiState changes AKA when the class category changes, not the value of the category. Thus, the previous stage of implementation with the sealed interface MUST be implemented in order for mutable state to work.</li></ol><pre id="4614f490-65d7-46e9-85d9-fabc05e6c4b6" class="code code-wrap"><code>// Create observable network state holder
private val_networkUiState = MutableStateFlow(NetworkUiState())
// Create accessor to network state values
valnetworkUiState: StateFlow&lt;NetworkUiState&gt; = _networkUiState</code></pre></li></ol><p id="3a5a0665-3ac6-4887-813f-a1a03fad2f30" class=""><code>var networkUiState : NetworkUiState by mutableStateOf(NetworkUiState.Loading)</code><div class="indented"><p id="43b52633-95a2-4ad3-b137-af759fd00fdf" class=""><code>private set</code></p></div></p></li></ol><ol type="a" id="58979970-9148-44fe-b2b7-a7d714768ce1" class="numbered-list" start="3"><li>Update the <code>getData()</code> method to use a try-catch block, passing successful results as parameters to Success and failed attempts to Error<p id="b191c444-cd2a-484b-b4fe-b91b8077f4a6" class=""><code>viewModelScope.launch {</code><div class="indented"><p id="924aa496-a4eb-46bf-87b3-bdc88182ed10" class=""><code>networkUiState = try {</code><div class="indented"><p id="9c9d84da-a6e3-4f2c-93b1-7ed1dab93f54" class=""><code>val listResult = AppApi.retrofitService.getData()</code></p><p id="42038f13-344e-4940-9498-407efcb33fca" class=""><code>NetworkUiState.Success(listResult)</code></p></div></p><p id="03b51a1d-481f-486b-a462-c926353d39ff" class=""><code>} catch (e: IOException) {</code><div class="indented"><p id="fbc1cc55-3147-491d-926f-f560e6bad843" class=""><code>NetworkUiState.Error</code></p></div></p></div></p></li></ol></li></ol><ol type="1" id="3c6ca326-defc-4f57-b138-04ef163b6e26" class="numbered-list" start="7"><li>Use a when expression on the result displaying screen to display the appropriate images and / or data for Loading Vs Error Vs Success<p id="bc2c17e6-38f0-4664-8821-19e21265cc7e" class=""><code>when (networkUiState) {</code><div class="indented"><p id="7e3389d0-dfc5-4f0e-916b-bdc098b633af" class=""><code>is NetworkUiState.Loading -&gt; LoadingScreen</code></p><p id="7b3b98e7-0243-44c4-995e-62187a4ed67b" class=""><code>is NetworkUiState.Error -&gt; ErrorScreen</code></p><p id="f85702f6-048e-4eb8-b4b1-3d4c7c7f6c74" class=""><code>is NetworkUiState.Success -&gt; ResultScreen</code></p></div></p></li></ol><ol type="1" id="8ac852c3-34c9-4612-a55f-2dd66116ab24" class="numbered-list" start="8"><li><strong><strong><strong><strong><strong>Check</strong></strong></strong></strong></strong><ol type="a" id="286863df-651e-41b5-98c4-163dd0afa4b2" class="numbered-list" start="1"><li>Ensure that data is still being correctly pulled through the system and that both loading and error conditions are being correctly handled</li></ol></li></ol><ol type="1" id="a16a88ba-9865-4c6d-8e28-bc1dfff7d792" class="numbered-list" start="9"><li><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong>Parse JSON into objects using Kotlin serialization</strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span><p id="8e23f98d-3662-41db-850d-f103ad84eb18" class="">Replace Scalar Converter Gradle dependencies with Kotlin JSON Serialization Converter</p><ol type="1" id="4576b97e-3d2b-455b-b6c1-6aae0972069e" class="numbered-list" start="1"><li>Add Kotlin Serialization Plugin<p id="e6bed715-4d07-445d-b9c6-3b5611de02cb" class=""><code>id &#x27;org.jetbrains.kotlin.plugin.serialization&#x27; version &#x27;1.8.10&#x27;</code></p></li></ol><ol type="1" id="7b62e7ec-c196-4da6-9ee6-a2b97374ca08" class="numbered-list" start="2"><li>Add Kotlin Serialization Dependency<p id="d5593249-c7e2-459b-aef5-9fe96f0958ff" class=""><code>implementation &#x27;org.jetbrains.kotlinx:kotlinx-serialization-json:1.5.1&#x27;</code></p></li></ol><ol type="1" id="98c522e2-7b6e-43ac-8578-0d9865a22aae" class="numbered-list" start="3"><li>Add Retrofit with Kotlin Serialization Converter<p id="7935a09e-daec-4304-9200-39b3f5d284e1" class=""><code>implementation &#x27;com.jakewharton.retrofit:retrofit2-kotlinx-serialization-converter:1.0.0&#x27;</code></p><p id="7801064f-325f-4392-a71e-0af28e1f52ce" class=""><code>implementation &#x27;com.squareup.okhttp3:okhttp:4.11.0&#x27;</code></p></li></ol><ol type="1" id="a42dde43-dcec-482e-9977-7c875f105400" class="numbered-list" start="4"><li>Remove Retrofit with Scalar Converter<p id="c2c365e4-d069-42f3-8fa2-a09a94723465" class=""><del><code>com.squareup.retrofit2:converter-scalars:2.9.0</code></del></p></li></ol></li></ol><ol type="1" id="a8832d00-3062-4922-98d4-b492ce74316b" class="numbered-list" start="10"><li>Create the data class needed for kotlin serializer to convert JSON to kotlin objects<ol type="a" id="2a9990db-da8e-4eef-939b-6643717c6eec" class="numbered-list" start="1"><li>Create data class in network package</li></ol><ol type="a" id="0b988eb6-539f-4eee-9221-59324485b8d2" class="numbered-list" start="2"><li>Prefix the class with annotation <code>@Serializable</code></li></ol><ol type="a" id="c010bede-8f28-4333-becd-ab11270ea741" class="numbered-list" start="3"><li>Define required class parameters within ellipses</li></ol><ol type="a" id="6c12e587-63e5-46e2-9a1e-31123931a1cb" class="numbered-list" start="4"><li>Whenever a class parameter name differs from that in the JSON response:<p id="dd46e96a-02ca-4f68-9176-367f6533ccb9" class=""><code>@SerialName(value = &quot;selfLink&quot;)</code></p><p id="2ec8c9c8-f984-489d-83a1-1cd37850d794" class=""><code>val link: String</code></p></li></ol></li></ol><ol type="1" id="01ced780-aee3-4ad7-9eba-8d77219eedd9" class="numbered-list" start="11"><li>Replace <code>ScalarConverterFactory</code> with Kotlin Serialization<ol type="a" id="7d2b78df-a318-41e4-af6a-01245491adff" class="numbered-list" start="1"><li>Within <code>AppApiService</code> replace:<p id="9eddeba6-f17e-484a-8c78-9d6d2b09e862" class=""><del><code>import retrofit2.converter.scalars.ScalarsConverterFactory</code></del></p><p id="45e1dbec-2f5f-4dd9-8bd8-97dbc13e1bfa" class=""><del><code>ScalarsConverterFactory.create()</code></del></p><p id="8a647ed1-ce83-4e9e-9209-a3d6c8bde7c3" class="">with</p><p id="990d1efd-4d58-4201-b563-41d23cb33f19" class=""><code><em>import </em></code><code>com.jakewharton.retrofit2.converter.kotlinx.serialization.asConverterFactory</code></p><p id="2f47342d-9acb-4dc0-9fef-14163781d6af" class=""><code><em>import </em></code><code>kotlinx.serialization.json.Json</code></p><p id="fa962be9-c65a-4ab4-ac4e-08a8fe80fdfb" class=""><code><em>import </em></code><code>okhttp3.MediaType.Companion.toMediaType</code></p><p id="2e75dce3-0e81-4018-a8bd-f118197542ea" class=""><code>Json.asConverterFactory(&quot;application/json&quot;.toMediaType())</code></p></li></ol></li></ol><ol type="1" id="badf6333-8cf2-4d4d-841a-cc8b57cef4fd" class="numbered-list" start="12"><li>Update App API service interface to return a list of objects instead of a string<p id="4b9233a5-60cc-4020-a209-edaa89a4bde4" class="">replace:</p><p id="7bfb3624-3fbb-41d4-b5f3-a5908619fb6a" class=""><del><code>suspend fun getData(): String</code></del></p><p id="54d81b11-2abd-47ed-b292-89b5e20705b2" class="">with</p><p id="eb35719c-353d-433b-8f11-68951ea1a9b3" class=""><code>suspend fun getData(): List&lt;Object&gt;</code></p><p id="e615ca5a-380a-4473-addb-9f829730b5d3" class="">***<strong><span style="border-bottom:0.05em solid">NB</span></strong>:<div class="indented"><p id="21dbb835-320c-4783-9b6f-98bf3c1ef646" class="">Pay close attention to the JSON header and note the data type being imported. JSON starting with <code>[</code> denotes a <code>List</code> while JSON beginning <code>{</code> denotes an <code>Object</code> and must be handled accordingly. Failure to do so will result in serializer reaching the end of the file without encountering the correct opener.</p></div></p></li></ol><ol type="1" id="782c622d-016e-4cdd-ba71-3f55f686f2f8" class="numbered-list" start="13"><li>Update View Model to also pass the result not from a String but from a List, temporarily using a string from the list in order to verify function as expected to this point<p id="1a1c9e80-f827-49d0-94eb-a6d08ce9dda5" class="">replace:</p><p id="3a6446cf-2e27-44e9-8ef4-8ae516661eed" class=""><del><code>NetworkUiState.Success(listResult)</code></del></p><p id="91202598-6279-469e-9689-f13dece61168" class="">with</p><p id="ca4e4fce-709f-4386-b892-b351c76a101d" class=""><code>NetworkUiState.Success(&quot;Success: ${listResult.size} objects retrieved.&quot;)</code></p></li></ol><ol type="1" id="3bca5365-48fa-44a0-8f28-99129e4669ce" class="numbered-list" start="14"><li><strong><strong><strong><strong><strong>Check</strong></strong></strong></strong></strong><ol type="a" id="386bb4e9-a6cc-4a60-896c-34a18cd8a7c9" class="numbered-list" start="1"><li>Now that data is being serialised and not simply imported as a string, ensure that data and all relevant fields are being correctly pulled through and populated.</li></ol></li></ol><ol type="1" id="e3cdbf33-a773-4213-9182-724751733e60" class="numbered-list" start="15"><li><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong>Add data repository and manual dependency injection</strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span><ol type="a" id="b8982fff-95c6-4589-9abe-eef6269381b0" class="numbered-list" start="1"><li>Must have one repository per data type</li></ol><ol type="a" id="ddb24ca6-adbc-416e-a49b-293ee1b6134e" class="numbered-list" start="2"><li>Data types should be immutable in order to be tamper-free and able to handled by multiple threads</li></ol></li></ol><ol type="1" id="2787f6de-b23d-424b-a85d-ffee8692f839" class="numbered-list" start="16"><li>Create Data Repository<ol type="a" id="9d3ab2ab-af99-4611-81a1-161f71cfa25e" class="numbered-list" start="1"><li>Named after the data that they are responsible for with <code>[type of data] + Reposipory</code>, stored in the data package.</li></ol><ol type="a" id="548ae39d-a684-4ad8-91b9-d49e7ca3e75d" class="numbered-list" start="2"><li>Create an interface declaration for the repository:<p id="a81936c0-009d-4efc-824d-14a80f8f58a6" class=""><code>interface DataRepository {</code><div class="indented"><p id="9c1b3ecd-7580-4d63-83c3-86bd664692d5" class=""><code>suspend fun getData(): List&lt;Data&gt;</code></p></div></p></li></ol><ol type="a" id="51c21146-b7c9-4e66-9c3e-c31eedf33450" class="numbered-list" start="3"><li>Create a network interface class declaration and override the <code>getData()</code> method to use the previously constructed network API call:<p id="bf162810-c2d0-4564-82d5-7fa8566c2654" class=""><code>class NetworkDataRepository() : DataRepository {</code><div class="indented"><p id="8af82514-6722-4da9-bffd-5b63bba12b02" class=""><code>override suspend fun getData(): List&lt;Data&gt; {</code><div class="indented"><p id="9adcf903-c5e2-4606-a4b3-b6fb65323773" class=""><code>return AppApi.retrofitSurvice.getData()</code></p></div></p></div></p></li></ol><ol type="a" id="1ffaaa72-3aa0-4273-9259-69472ba16fb7" class="numbered-list" start="4"><li>Update View Model to pull from the network repository:<p id="c28fed23-56c5-4e67-b5e4-18e4d68fddc8" class="">Navigate to the View Model and the <code>getData()</code> method, replacing:</p><p id="3c1d56ac-a2be-47b2-836d-534ac2052443" class=""><code>val listResult = AppApi.retrofitService.getData()</code></p><p id="1c6cb916-cde8-49be-9f59-d39668233cde" class="">with</p><p id="1ede4927-64a4-4dc1-b138-bf6b3a6115fb" class=""><code>val dataRepository = NetworkDataRepository()</code></p><p id="a036fae4-1f81-46c6-9937-90f08d673b9f" class=""><code>val listResult = dataRepository.getData()</code></p></li></ol><ol type="a" id="04dac50d-cc90-454c-aa42-e714453ecfd8" class="numbered-list" start="5"><li>At this point, the View Model is no longer directly making the network request for data but is instead querying the data repository, which is providing the data. In other words, the View Model no longer directly references the API.</li></ol></li></ol><ol type="1" id="c012c03a-d922-45d1-b84b-4e1658267834" class="numbered-list" start="17"><li><strong><strong><strong><strong><strong>Check</strong></strong></strong></strong></strong><p id="7d8300ad-4ab1-468d-9312-f09b170a00c8" class="">Ensure that data is still being correctly pulled through data repository</p></li></ol><ol type="1" id="1329cc21-48d9-4fb7-8667-f8949a2cf24b" class="numbered-list" start="18"><li>Create Application Container<ol type="a" id="393bba17-a12c-4107-b998-c56220d790c2" class="numbered-list" start="1"><li>This will contain the dependencies that the app requires, and will pass the repository to the View Model, enabling the View Model to be independent from the repository</li></ol><ol type="a" id="fd12d6b2-a2af-4b09-af3f-258e88eb2484" class="numbered-list" start="2"><li>Within <code>data</code>, create an <code>Interface</code> named <code>AppContainer</code>, which holds the value of the Data Repository - <code>val dataRepository: DataRepository</code></li></ol><ol type="a" id="5ac1f7c3-e807-48bd-9ee1-4aa1726cca60" class="numbered-list" start="3"><li>Create a <code>DefaultAppContainer</code>, directly below the interface definition, that will provide the default environment at runtime, outside of testing purposes</li></ol><ol type="a" id="db161e9f-6ce8-4ca2-ae1f-1f7dd21b442c" class="numbered-list" start="4"><li>Move the logic from <code>network/AppApiService</code> to this container, including the base Url, retrofit and retrofit service. Note that when moving constants for a class the constant will be removed as it has now become part of a class.</li></ol><ol type="a" id="59416ede-5d6e-4047-9b8a-7a9fc54a2600" class="numbered-list" start="5"><li>In the default container, override the data repository value defined by the container to be that of the network API service. The app container code should look something like below. </li></ol><ol type="a" id="743c8548-1134-4607-a6c1-d997f7add95a" class="numbered-list" start="6"><li>TODO</li></ol></li></ol><ol type="1" id="916c49c1-2353-47a0-868f-4ab2d20eaacf" class="numbered-list" start="19"><li>Update Network Repository and API Service<ol type="a" id="02df1baf-83c5-44cc-87a2-fe913d87cb48" class="numbered-list" start="1"><li>We are now passing the retrofit service to the repository and so must update the network repository to accept this as a parameter instead of holding the value within its own code, and must update the network call to use this parameter</li></ol><pre id="90e2cba7-9470-425d-a318-d9e9d007b1f4" class="code"><code>class NetworkBookRepository(
    private val bookApiService: BookshelfApiService
) : BookRepository{
    override suspend fun getBooks(): SearchResult = bookApiService.getBooks()
}</code></pre><ol type="1" id="e3d2c6b0-2e07-4181-84fa-da4f8637bc20" class="numbered-list" start="1"><li>We can now remove the object previously temporarily created within the API service, as it will no longer be referenced as this function has been depreciated with DI.</li></ol></li></ol><ol type="1" id="4c4f440a-dd37-4bd9-b2d0-fd0de9c5b2eb" class="numbered-list" start="20"><li>Attach Application Container to the app<ol type="a" id="c78dbd18-2372-46c3-a56b-93479f8b31d6" class="numbered-list" start="1"><li>We will now attach the default app container to the app to be initialized during <code>onCreate()</code> (and must thus be created during <code>lateInit</code>) whereas a test container can be used for testing purposes.</li></ol><ol type="a" id="24c7249e-ac14-482c-a138-edae420bfd12" class="numbered-list" start="2"><li>Within the main directory, create a class <code>AppApplication</code>, which extends the Application object.<p id="9e1e46b2-be29-48b8-9677-577ecc4841e4" class=""><code>class AppApplication : Application() {</code></p></li></ol><ol type="a" id="5bab4379-2959-43f8-8f82-77c0c17d87d1" class="numbered-list" start="3"><li>Define the late initialised app container variable and override the <code>onCreate()</code> function to use this parameter<p id="df1aed81-b28e-4332-85eb-5a37422d1a76" class=""><code>lateinit var container: AppContainer</code></p><p id="31d12965-1650-4be2-aa19-7fdb38bad3cd" class=""><code>override fun onCreate() {</code><div class="indented"><p id="44f66ea8-3210-4ce7-8b87-6e6f3fd2600b" class=""><code>super.onCreate()</code></p><p id="c90f2cc1-bced-47e4-9b9a-08399e2a634e" class=""><code>container = DefaultAppContainer()</code></p></div></p></li></ol><ol type="a" id="d3f455cd-f609-4631-b66f-3e1fba9c7765" class="numbered-list" start="4"><li>Update the Android Manifest so that the app uses the application class defined above and not the default application class<p id="afc53581-8872-44fb-8600-ec5706966057" class=""><code>&lt;application</code><div class="indented"><p id="184a8e96-dba3-410b-b763-86a905ff03be" class=""><code>android:name=&quot;.AppApplication&quot;</code></p><p id="83477ebf-aa0e-4c97-8a7d-f1690323f75b" class=""><code>android:allowBackup=&quot;true&quot;</code></p></div></p></li></ol></li></ol><ol type="1" id="99570a47-678e-4f4e-a960-46c5b2972cd5" class="numbered-list" start="21"><li>Add Repository to View Model<ol type="a" id="872bfc5d-a5a5-4b8c-9bfb-6aae674ec601" class="numbered-list" start="1"><li>Now that the repository and API service have been decoupled from the View Model, the View Model must be passed the repository to retrieve data.</li></ol><ol type="a" id="a8941611-4cff-4197-b392-c1ed71545b29" class="numbered-list" start="2"><li>Update View Model class declaration to receive constructor for the repository…<p id="72ebb3fd-c694-445e-9b3c-a4185387c13b" class=""><code>class AppViewModel(private val dataRepository: DataRepository) : ViewModel()</code></p></li></ol><ol type="a" id="8713c9b5-5085-473b-9aec-454c4b9f5155" class="numbered-list" start="3"><li>… and then remove the previous reference to this<p id="878ed63c-ac49-4e1c-8cf4-d07cafd755a9" class=""><del><code>val dataRepository = NetworkDataRepository()</code></del></p></li></ol><ol type="a" id="01460a80-2ff4-4910-aab0-ff6c86aa89d2" class="numbered-list" start="4"><li>Create <code>ViewModelProvider.Factory</code> in order to circumvent the fact that the Android framework does not allow a View Model to be passed values in the constructor when created. This will use the app container to retrieve the repository and then pass this to the View Model when the View Model is created.<ol type="i" id="5e0dd86b-b5e8-4a1e-bc82-d3ae70558583" class="numbered-list" start="1"><li>Create a companion object (singleton pattern) that is used by everyone without the need to create a new instance of an expensive object. Note that the APPLICATION_KEY is part of the object used to find the app’s <code>AppApplication</code> object, which contains the <code>container</code> property needed to retrieve the repository</li></ol><ol type="i" id="5f0f42a2-2736-495a-a54f-60a05f9b3f13" class="numbered-list" start="2"><li>Below the <code>getData()</code> function:<p id="7d999b94-b3b8-4e43-b3bb-a140fcd575f1" class=""><code>companion object {</code><div class="indented"><p id="0fa294d2-595d-4621-ab5a-bbe175119455" class=""><code>val Factory: ViewModelProvider.Factory = viewModelFactory {</code><div class="indented"><p id="1e18d5b7-6891-4ee2-b3c9-5c174462ad2d" class=""><code>initializer {</code><div class="indented"><p id="6f2ee470-198e-4d04-9ea9-c948609d33a1" class=""><code>val application = (this[APPLICATION_KEY] as AppApplication)</code></p><p id="1c1733b1-0a65-46a4-93c1-3594d6f123ca" class=""><code>val dataRepository = application.container.dataRepository</code></p><p id="02986e5c-172c-4b35-96f2-ad0c9c43c025" class=""><code>AppViewModel(dataRepository = dataRepository)</code></p></div></p></div></p></div></p></li></ol></li></ol><ol type="a" id="8d6a8c3f-3644-4e22-bbe8-a153dc4e9d04" class="numbered-list" start="5"><li>Update View Model to use the created Factory within AppApp.kt<p id="ddf9366f-7716-4e30-bff1-e830a076ab77" class=""><code>Surface() {</code><div class="indented"><p id="6d9e60cd-e6ba-41b4-8cfe-27fc8b152d0c" class=""><code>val appViewModel: AppViewModel = viewModel(factory = AppViewModel.Factory)</code></p></div></p></li></ol></li></ol><ol type="1" id="3bacb694-0763-4d1c-97cb-6dd92c0c7167" class="numbered-list" start="22"><li><strong><strong><strong><strong><strong>Check</strong></strong></strong></strong></strong><ol type="a" id="6c4155b5-330e-4a81-a4d4-a319e33e8b42" class="numbered-list" start="1"><li>The app should now have manual Dependency Injection which decouples the data / repository from the app / View Model. It should however currently function exactly as it did before. Now is a good time to ensure that it is functioning as expected.</li></ol></li></ol><ol type="1" id="ca50409f-4151-4481-aeea-d75dbce143dd" class="numbered-list" start="23"><li>Set up local test environment<ol type="a" id="b9255184-6891-4cd5-bfcb-b20c23eb5a07" class="numbered-list" start="1"><li>Add local test dependencies in gradle<p id="c29ef1be-7f86-4a1d-8132-6a56e44a05dd" class=""><code>testImplementation &#x27;junit:junit:4.13.2&#x27;</code></p><p id="3483dce1-180d-473c-a616-f77f3e870d3f" class=""><code>testImplementation &#x27;org.jetbrains.kotlinx:kotlinx-coroutines-test:1.7.1&#x27;</code></p></li></ol><ol type="a" id="49917ba3-5726-455c-9016-d36256b69e20" class="numbered-list" start="2"><li>Create local test directory<p id="641860db-6ffc-4a0f-ad99-7a0f466fae12" class="">Within <code>src</code>: new → directory → <code>test/java</code></p><p id="a23b66d3-76dd-49b2-aa36-3b5117a7da2f" class="">Within <code>test/java</code>: package → <code>com.example.appname</code></p></li></ol></li></ol><ol type="1" id="ffd8537e-0bd2-4cd0-b62b-6d7316e65a5c" class="numbered-list" start="24"><li>Create fake data and dependencies<ol type="a" id="5e37040a-3592-4263-b806-c1b421229986" class="numbered-list" start="1"><li>create a folder for the fake data - <code>test/java/com.example.appname.test</code></li></ol><ol type="a" id="f193a421-8d9c-4a31-9359-cbab1b77c3b0" class="numbered-list" start="2"><li>create a fake data source object in <code>FakeDataSource</code><p id="1517396e-1f30-479e-a625-ac90c3b295e8" class=""><code>object FakeDataSource {</code><div class="indented"><p id="64d004d7-e05d-472b-ba3c-b9a5f298915d" class=""><code>const val [idOne] = &quot;one&quot;</code></p><p id="9cba24a2-41cf-4685-a7b9-353433232427" class=""><code>const val [idTwo] = &quot;two&quot;</code></p><p id="50b60f50-aa82-43e5-951b-85f8b25ca841" class=""><code>val dataList = listOf (</code><div class="indented"><p id="fc93eda2-8227-463d-9e50-d37e6bc10ce3" class=""><code>DataObject([idOne]),</code></p><p id="4a2c5c46-4969-45ce-a907-adb57deddd77" class=""><code>DataObject([idTwo])</code></p></div></p></div></p></li></ol><ol type="a" id="b96344d5-936d-4e25-930a-2fb81e1a0b69" class="numbered-list" start="3"><li>create a fake API service in <code>FakeAppApiService</code><p id="b2bb9208-3f69-4eb4-a2a4-4459039b0b38" class=""><code>class FakeAppApiService : AppApiService {</code><div class="indented"><p id="38ef3e53-cdad-4fb2-ac5d-a2056b5a2cb7" class=""><code>override suspend fun getData(): List&lt;Data&gt; {</code><div class="indented"><p id="39a8947b-597f-458a-897a-b92fcd312bc4" class=""><code>return FakeDataSource.dataList</code></p></div></p></div></p></li></ol></li></ol><ol type="1" id="9015e21f-385f-4b9e-8c9c-a0299db2a16a" class="numbered-list" start="25"><li>Initiate repository testing<ol type="a" id="fb4f1fbc-60a3-4e14-a73d-a71203f0be4e" class="numbered-list" start="1"><li>This will create an initial repository, testing the <code>getData()</code> method of the <code>NetworkAppRepository</code>, which should be built upon over time to test all aspects of the data repository</li></ol><ol type="a" id="d107496c-f09d-42af-a63b-208ff8597fdd" class="numbered-list" start="2"><li>Within the fake directory, create class <code>NetworkAppRepositoryTest</code></li></ol><ol type="a" id="7b1bf3e4-2aef-45d8-b722-3fe3a6289136" class="numbered-list" start="3"><li>In addition to the standard <code>@Test</code> annotation we must also account for the fact that we are testing a coroutine and must thus launch from a coroutine scope. To do this the body of the test method must be run from the lambda of Kotlin coroutines’ <code>runTest()</code> method.<p id="709c70d1-1bfa-474d-8d3b-5f98f6aca983" class="">In order to do this, the test function must be an expression equal to the <code>runTest()</code> function.</p></li></ol><ol type="a" id="300b5f04-404b-4a24-a4bb-b054656a9ed7" class="numbered-list" start="4"><li>To test the repository we will need an instance of <code>NetworkAppRepository</code> into which we will pass the <code>FakeAppApiService</code> as the API service.</li></ol><ol type="a" id="71817cd9-fbca-4198-ac76-0926507ddce1" class="numbered-list" start="5"><li>We will then compare this with <code>assertEquals()</code> to the <code>FakeDataSource</code><pre id="566eb00f-eb10-497f-b18a-c09cd3fc7804" class="code"><code>class NetworkBookRepositoryTest {
    @Test
    fun networkBookRepository_getBooks_verifyBookList() =
        runTest {
            val repository = NetworkBookRepository(
                bookApiService = FakeApiService()
            )
            assertEquals(
                repository.getBooks(),
                FakeDataSource.searchResult</code></pre></li></ol></li></ol><ol type="1" id="68ed89c9-d618-4ee0-8f77-8a0544077c4b" class="numbered-list" start="26"><li>Initiate View Model testing<ol type="a" id="1a86d257-4c32-428f-ae4f-9f706056f469" class="numbered-list" start="1"><li>create a fake data repository in the fake directory called <code>FakeNetworkDataRepository</code>, which extends the <code>DataRepository</code> and overrides the <code>getData()</code> function to return the fake data source (list) created in step 24<p id="5fa4dfbf-98da-424f-a626-8f1ac1f112ff" class=""><code>class FakeNetworkDataRepository : DataRepository {</code><div class="indented"><p id="134b8a04-4e23-4c83-abfb-a13e37423813" class=""><code>override suspend fun getData() : List&lt;Data&gt; {</code><div class="indented"><p id="25ad64ec-0482-473b-b3b0-f4feff86c205" class=""><code>return FakeDataSource.dataList</code></p></div></p></div></p></li></ol><ol type="a" id="de23b35a-6e57-4088-a582-98df40c61da2" class="numbered-list" start="2"><li>Because the App View Model calls the repository using <code>viewModelScope.launch()</code> which is not available to a unit test, we must create a <code>TestDispatcher</code> in order to mimic the Android environment to run these tests. We will use <code>Dispatchers.setMain()</code> to replace the main dispatcher for each test calling for this and then reset again at the end of each such test with <code>Dispatchers.resetMain()</code>. To simplify this we will create a rule which does so for us as outlined below</li></ol><ol type="a" id="844cdfa5-df66-4963-b3ca-c0384e229145" class="numbered-list" start="3"><li>Create a TestRule to replace the Main dispatcher with our Test Dispatcher<ul id="58650031-7c38-46ac-9f2e-dc9f8a33e044" class="bulleted-list"><li style="list-style-type:disc">Create a new package in the test folder called <code>rules</code></li></ul><ul id="8ea00934-180c-46ef-b47b-97a17e7ade60" class="bulleted-list"><li style="list-style-type:disc">Create a class named <code>TestDispatcherRule</code>, extending <code>TestWatcher</code></li></ul><ul id="07ff917b-8259-49b7-82f1-784fe5639aec" class="bulleted-list"><li style="list-style-type:disc">Implement the starting and finished conditions, passing in the type of dispatcher required, in this case an unconfined test dispatcher<pre id="385ade6a-33d9-4c8b-a2d0-3e175a0ab230" class="code code-wrap"><code>class TestDispatcherRule(
    val testDispatcher: TestDispatcher = UnconfinedTestDispatcher(),
) : TestWatcher() {
    override fun starting(description: Description) {
        Dispatchers.setMain(testDispatcher)
    }

    override fun finished(description: Description) {
        Dispatchers.resetMain()
    }
}</code></pre></li></ul><p id="44ce5804-686a-44d1-9d66-b5f8f52896d8" class=""><div class="indented"><p id="0b646bbd-4fc9-493d-9d27-6037a29cacfd" class="">
</p></div></p></li></ol><ol type="a" id="7995ca5c-710d-47ae-8386-ac46fe1b0ca2" class="numbered-list" start="4"><li>Apply this rule to all of the tests within our (new) test View Model Class<p id="4c38f53a-2be6-4d5c-91ab-4fef4995dc78" class=""><code>class AppViewModelTest {</code><div class="indented"><p id="1741a89f-2be5-4c23-901b-cc36be5c3e83" class=""><code>@get : Rule</code></p><p id="e6e17f6a-b553-45d8-9ed4-6f1bdc9cd42c" class=""><code>val testDispatcher = TestDispatcherRule()</code></p></div></p></li></ol><ol type="a" id="ef7f3f39-531c-4d21-92bd-a175f372cc74" class="numbered-list" start="5"><li>Create a simple test to ensure that our test dispatcher is working correctly and also that the view model is returning the UI state that we expect it to return, again using the <code>runTest()</code> method in order to ensure it is run within a coroutine scope.<p id="7e212a5e-17c7-4f05-bf0c-17c335f0cbc3" class=""><code>@Test</code></p><p id="7a13d950-173e-488d-9eb1-1059d3b5473e" class=""><code>fun viewModel_getData_verifyUiStateSuccess() = </code><div class="indented"><p id="d22d5ae3-85eb-40d7-ac49-2465eca65f31" class=""><code>runTest {</code><div class="indented"><p id="dae50f4f-eaad-408c-8998-3f2788c08d8b" class=""><code>val viewModel = AppViewModel(</code><div class="indented"><p id="e1e37001-2b8e-4052-87b2-5a3a8cf4ad1f" class=""><code>dataRepository = FakeNetworkDataRepository()</code></p></div></p><p id="742376d3-de8c-4632-8164-8b1b717bcd08" class=""><code>)</code></p><p id="91f4c104-d19c-4d91-9f27-7966e0b00866" class=""><code>assertEquals(</code><div class="indented"><p id="06a1a833-71a9-45dc-8933-ea5632f9c213" class=""><code>AppUiState.Success([variable]),</code></p><p id="5e00fbcf-6282-4ff1-a70c-b9a327ff214e" class=""><code>viewModel.appUiState</code></p></div></p></div></p></div></p></li></ol></li></ol><p id="41d7705b-0591-4c3b-a9b0-e84d1978f69d" class="">
</p><h2 id="127ad748-5d8c-4d54-ad90-8e3be9ad2f98" class="">SQLite</h2><p id="4fd3eb7f-f7eb-4b5a-a022-d822382498b3" class="">Provided by default by the Android SDK</p><ul id="df97f135-afb2-46bf-ae0a-72268f302293" class="bulleted-list"><li style="list-style-type:disc">Convention dictates table naming should be lowercase and singular</li></ul><ul id="687a8e91-fe3b-486d-be24-076b46576de6" class="bulleted-list"><li style="list-style-type:disc">All queries must be suffixed with a semicolon</li></ul><ul id="11958774-ff0e-411c-8db0-57c89c7a2fe8" class="bulleted-list"><li style="list-style-type:disc">Kotlin Vs SQLite points of differentiation:<ul id="a6ee4f06-027e-4284-a103-9be2217df8e6" class="bulleted-list"><li style="list-style-type:circle">Kotlin Vs SQLite data types:<ul id="8f6720f4-8889-4cc2-8503-f4c7f0e73748" class="bulleted-list"><li style="list-style-type:square">Int → INTEGER</li></ul><ul id="a2cfa745-886d-4292-a4e9-64ea25cc3965" class="bulleted-list"><li style="list-style-type:square">String → VARCHAR or TEXT</li></ul><ul id="0f1c9240-6ffe-4c56-a354-f41f3bb9d56d" class="bulleted-list"><li style="list-style-type:square">Boolean → BOOLEAN</li></ul><ul id="298ca92c-bf7f-4b5c-a2b1-c261377fc1d1" class="bulleted-list"><li style="list-style-type:square">Float or Double → REAL</li></ul></li></ul><ul id="44ff8cd3-010a-476e-a312-036755bd93c0" class="bulleted-list"><li style="list-style-type:circle">In a where statement: == → =</li></ul><ul id="ac5aefd5-af73-4bc2-8134-59d2e459722e" class="bulleted-list"><li style="list-style-type:circle">&amp;&amp; → AND</li></ul><ul id="07d59816-2216-48fa-86fd-263d157b2b47" class="bulleted-list"><li style="list-style-type:circle">|| → OR</li></ul><ul id="0345856c-e3ba-4df2-bbe1-e66defe6d511" class="bulleted-list"><li style="list-style-type:circle">! → NOT</li></ul><ul id="9266357f-3e4e-481e-a40d-300dfe5aba65" class="bulleted-list"><li style="list-style-type:circle">“ “ → ‘ ‘</li></ul></li></ul><ul id="ef29f40d-2866-46c5-9638-1cbb2bd00262" class="bulleted-list"><li style="list-style-type:disc">Usage:<ul id="4478948c-12b1-4756-afd1-16f1985b5897" class="bulleted-list"><li style="list-style-type:circle">LIKE: <code>&#x27;%[search]%&#x27;</code><ul id="0289714c-e155-4749-8599-cd0b9d218fe5" class="bulleted-list"><li style="list-style-type:square">prefix: <code>&#x27;[search]%&#x27;</code></li></ul><ul id="8be613f9-db8d-4c29-8e60-a36bc1e796a6" class="bulleted-list"><li style="list-style-type:square">suffix: <code>&#x27;%[search]&#x27;</code></li></ul></li></ul><ul id="76d9d503-a210-4784-86a4-f981325cae0a" class="bulleted-list"><li style="list-style-type:circle">GROUP BY: to partition an aggregate function</li></ul><ul id="4bb35123-a7b3-4688-b6cb-de05c79337d7" class="bulleted-list"><li style="list-style-type:circle">ORDER BY [column name] [sort direction]</li></ul><ul id="fa61ab7e-15da-432b-bd1a-cbcde768b7d9" class="bulleted-list"><li style="list-style-type:circle">LIMIT [max rows] OFFSET [rows to skip]</li></ul><ul id="14314ec5-1411-4744-9679-c7b0217831e3" class="bulleted-list"><li style="list-style-type:circle">INSERT INTO [table]<ul id="e568bd04-220b-4acf-9ac3-df2c089485e8" class="bulleted-list"><li style="list-style-type:square">VALUES (variables in order)</li></ul></li></ul><ul id="fe85147c-3f2f-4126-972b-b652f2118b6d" class="bulleted-list"><li style="list-style-type:circle">CURRENT_TIMESTAMP is a special variable that is replaced with the current time in UTC</li></ul><ul id="96a9fd2b-ec13-458a-a896-46b842bfc604" class="bulleted-list"><li style="list-style-type:circle">UPDATE [table name]<ul id="7cab74c6-e7b2-4d85-9983-117d7ff4254b" class="bulleted-list"><li style="list-style-type:square">SET [sets of columns and values using equals, separated with comma]</li></ul><ul id="3572f49e-d2e2-4777-93c7-af4a1624537d" class="bulleted-list"><li style="list-style-type:square">WHERE…</li></ul></li></ul><ul id="8caa89be-7c07-4d78-bd41-16741a041951" class="bulleted-list"><li style="list-style-type:circle">DELETE FROM [table name] WHERE [condition]</li></ul></li></ul><p id="f34f7364-b2df-4711-95d5-d825848dcfcf" class="">
</p><h2 id="f1098aea-b178-4d0a-962b-78cce59ce51f" class="">Room</h2><ul id="6d340056-acd4-4681-bebd-195b4055cd54" class="bulleted-list"><li style="list-style-type:disc">Room entities represent tables in the app database and are used to update data in these tables.</li></ul><ul id="eb89b2ce-05a6-42fc-9fc8-029aae2ecc42" class="bulleted-list"><li style="list-style-type:disc">Room DAOs (Data Access Objects) provide methods used to retrieve, update, insert and delete data.</li></ul><ul id="c4e230ed-84ec-43e4-8863-d6f9e5b2779d" class="bulleted-list"><li style="list-style-type:disc">Room Database Class provides the app with instances of DAOs associated with the database</li></ul><ul id="d7f71fc7-2c40-4e47-9607-e2a614b9d548" class="bulleted-list"><li style="list-style-type:disc">The <code>@Entity</code> annotation marks a class as a database Entity class. For each class the app creates a database table to hold the items with each field representing a column in the database.</li></ul><ul id="398397e7-527f-413a-9ffa-dbda5cb648b2" class="bulleted-list"><li style="list-style-type:disc">By default, the table name is identical to the class name<p id="f92a78bb-7c29-4e30-9767-b8780bf6310e" class=""><code>@Entity(tableName = &quot;name&quot;)</code></p><p id="1f294d7a-ec41-4745-a4fc-07fb9440487a" class=""><code>data class Item(</code></p></li></ul><ul id="17e33ebf-084c-4a86-9c2c-016205b1b684" class="bulleted-list"><li style="list-style-type:disc">Every Entity must have a primary key, which must be annotated with <code>@PrimaryKey</code><p id="ad20b073-ed77-417f-89f7-c4349463f2d1" class=""><code>@PrimaryKey</code></p><p id="1a3fac5e-cb0a-4c4c-aca1-c264a93cd455" class=""><code>val id: Int = 0</code></p></li></ul><ul id="79018cd7-da87-4aa6-8310-0c90f92b9d84" class="bulleted-list"><li style="list-style-type:disc">The id should be assigned a default value of 0 in order to be auto-generated</li></ul><ul id="b3be75ae-a194-4cf3-a729-f266513c68a4" class="bulleted-list"><li style="list-style-type:disc">Room Function Annotations:<ul id="7a713737-3afb-4d4e-8362-3d9daaffab21" class="bulleted-list"><li style="list-style-type:circle">@Insert</li></ul><ul id="f770393c-a397-4e70-9640-99112ac66cb3" class="bulleted-list"><li style="list-style-type:circle">@Delete</li></ul><ul id="2ebec17e-042b-4eeb-a675-bfb4b5d2bca5" class="bulleted-list"><li style="list-style-type:circle">@Update</li></ul><ul id="2d92b745-2d8f-49bd-a7c2-37cd3df44f6a" class="bulleted-list"><li style="list-style-type:circle">@Query</li></ul></li></ul><h3 id="2b84b5f8-6fc4-4559-937e-c8929ca7060b" class="">Room Step-By-Step Implementation</h3><ol type="1" id="f84ad293-b21c-49ac-b6fa-f28ad7f6d44e" class="numbered-list" start="1"><li>Add gradle dependencies:<p id="d9cc1793-80da-4bb3-a640-769d86d3bbc8" class=""><code>implementation &#x27;androidx.room:room-runtime:${rootProject.extra[&quot;room_version&quot;]}&#x27;</code></p><p id="aa972390-40be-44a8-8945-f98edb63717c" class=""><code>ksp &#x27;androidx.room:room-compiler:${rootProject.extra[&quot;room_version&quot;]}&#x27;</code></p><p id="d9dd925a-e659-4ef6-8916-709c8699e79a" class=""><code>implementation &#x27;androidx.room:room-ktx:${rootProject.extra[&quot;room_version&quot;]}&#x27;</code></p></li></ol><ol type="1" id="7e37c1dd-9220-49be-ae98-57713da8f445" class="numbered-list" start="2"><li>Create an Entity in the data package<p id="2ec06943-4347-4c46-bd95-d16708a9d07b" class=""><code>@Entity(tableName = &quot;items&quot;)</code></p><p id="27b0e11c-0356-4a7b-8638-cefe444c0db5" class=""><code>data class ItemA</code><div class="indented"><p id="5c02cc94-9abe-491d-9866-63e585fe893b" class=""><code>val id: Int = 0,</code></p></div></p></li></ol><ol type="1" id="5c4e2d16-5cfe-4e5d-a282-e2d04898bc60" class="numbered-list" start="3"><li>Create a DAO in the data package with required functions in body<p id="f6cab8b2-a3db-436e-88ff-c279afc97e9b" class=""><code>@Dao</code></p><p id="22195fb7-203c-43c5-b425-5854bd7d3346" class=""><code>Interface ItemDao {</code><div class="indented"><p id="78746eea-0c6f-4f3f-bc3e-cf15d5c2af65" class=""><code>@Insert(onConflict = OnConflictStrategy.IGNORE)</code></p><p id="8fd90549-14dc-4125-ac70-edb7da429afc" class=""><code>suspend fun insert(item: Item)</code></p></div></p></li></ol><ol type="1" id="322d9d55-184f-46e8-a392-bcd62b5f072e" class="numbered-list" start="4"><li>Create a Database Instance<p id="89dfbd13-e3df-47c1-a6ea-0781b5a25a43" class="">The Room database that extends the Room Database will be abstract and annotated with @Database, containing one method that returns the existing instance of Room Database IF the database doesn’t exist, via a companion object.</p><pre id="657b5fbc-4bd0-4577-a1cd-88a34ce5c46f" class="code"><code>// Database class with a singleton Instance object.
@Database(entities = [Item::class], version = 1, exportSchema = false)
abstract class InventoryDatabase : RoomDatabase() {

    abstract fun itemDao(): ItemDao

    companion object {
        @Volatile
        private var Instance: InventoryDatabase? = null

        fun getDatabase(context: Context): InventoryDatabase {
            return Instance ?: synchronized(this) {
                Room.databaseBuilder(context, InventoryDatabase::class.java, &quot;item_database&quot;)
                    .fallbackToDestructiveMigration()
                    .build()
                    .also { Instance = it }
            }
        }
    }
}</code></pre></li></ol><ol type="1" id="8a677db7-1bc5-4403-af64-84a63a78a5fd" class="numbered-list" start="5"><li>Implement the Repository<ol type="a" id="ac0b59bb-bcc1-467f-98e1-f34870026464" class="numbered-list" start="1"><li>Create an item repository under the data package as an interface and map the DAO methods to the interface.<p id="02884ad7-e1c7-4ae0-a906-d3cea386b565" class=""><code>Interface ItemsRepository {</code><div class="indented"><p id="7339742f-c139-4cd8-b344-187ed8ff97f5" class=""><code>fun insertItem(item: Item)</code></p></div></p></li></ol><ol type="a" id="f43b61a0-4907-4902-b329-56235060f679" class="numbered-list" start="2"><li>create an offline repository, overriding the functions defined in the ItemsRepository, calling the corresponding functions from the DAO<p id="1c509cce-f539-42dc-a449-f51282ed98b1" class=""><code>class OfflineItemsRepository(private val itemDao: ItemDao) : ItemsRepository {</code><div class="indented"><p id="8e596588-e99f-40c4-b74c-5900b83a7658" class=""><code>override fun insertItem(item: Item) = itemDao.insert(item)</code></p></div></p></li></ol><ol type="a" id="e9cb6da5-239a-44f8-b6f6-4cbcaca081d4" class="numbered-list" start="3"><li>Implement the AppContainer Class within AppContainer.kt in the data package, passing in the Item DAO to the offline repository constructor and instantiating by calling the database build function<p id="ec2f0e00-a508-42c9-a73c-c19c8900c6e9" class=""><code>override val itemsRepository: ItemsRepository by lazy {</code><div class="indented"><p id="0845b4d5-54bf-4339-9540-c3e325a713c3" class=""><code>OfflineItemsRepository(InventoryDatabase.getDatabase(context).itemDao())</code></p></div></p></li></ol></li></ol><ol type="1" id="0a8d9678-ee69-4cfc-a8bf-3ebb0e8583ec" class="numbered-list" start="6"><li>Add save functionality by updating View Models<ol type="a" id="71ee1813-d01d-44a2-b22b-89144dc834a1" class="numbered-list" start="1"><li>Helper functions will be required within the View Model in order to convert:<ol type="i" id="2f3e9252-2a1c-4147-a32b-1c59bc6ed9e1" class="numbered-list" start="1"><li>Item details to item UI state</li></ol><ol type="i" id="9d8be74b-e78b-4e02-8ef9-82bd60e0934a" class="numbered-list" start="2"><li>item UI state to the Item Room entity object</li></ol><ol type="i" id="61097c66-e122-40be-b596-6d187d79c1e6" class="numbered-list" start="3"><li>Item room entity object to Item details</li></ol></li></ol><ol type="a" id="476b8834-52d2-4256-b491-1e88bba668f3" class="numbered-list" start="2"><li>Alter the View Model constructor to accept the repository<p id="54691648-4dfe-4b11-b0ad-e2d3da4e69ed" class=""><code>class ItemEntryViewModel(private val itemsRepository: ItemsRepository) : Viemodel() {</code></p></li></ol><ol type="a" id="8e8efeb4-7318-43c4-98e7-193acb064e36" class="numbered-list" start="3"><li>Update the initialiser for the entry view model passing in the repository instance as a parameter<p id="16621d6a-02cf-407b-8706-20406e93943a" class=""><code>initializer {</code><div class="indented"><p id="f1e593f9-06e5-4ae9-8a48-814e20715937" class=""><code>ItemEntryViewModel(inventoryApplication().container.itemsRepository)</code></p></div></p></li></ol><ol type="a" id="62f685ca-54cf-4b75-9c27-11f56847c25f" class="numbered-list" start="4"><li>Create a function within the View Model to save the item, using the View Model scope coroutine<p id="0054998c-b5fc-459e-b0a8-f101da821da3" class=""><code>suspend fun saveItem() {</code><div class="indented"><p id="9710a78d-a95e-4355-9352-7a4d89439930" class=""><code>if (validateInput()) {</code><div class="indented"><p id="f0cd90e6-03ef-4ae7-a96c-2ca72ba648fc" class=""><code>itemsRepository.insertItem(isemUistate.itemDetails.toItem())</code></p></div></p></div></p></li></ol><ol type="a" id="73acb683-39c7-4d56-9059-f4a54fb4b916" class="numbered-list" start="5"><li>Create a coroutine scope event listener (in this case to the submit button)<ol type="i" id="613ab77d-7c49-489a-9dfa-827de78593ea" class="numbered-list" start="1"><li>Within the top-level composable, create a coroutine scope listener<p id="99707c0c-a1db-417e-9c8d-cc6094361dfc" class=""><code>val coroutineScope = rememberCoroutineScope()</code></p></li></ol><ol type="i" id="144eade7-89a7-4761-8279-25b8cd144541" class="numbered-list" start="2"><li>Call and launch the coroutine within the “onClick” lambda, ensuring that you call the on click function within the View Model Scope as it is a coroutine<p id="2bd84702-2be3-496c-8cd3-4fd23daea04d" class=""><code>onClick = {</code><div class="indented"><p id="3a65fa50-48f4-4d4c-95b1-973f2bfe9d80" class=""><code>coroutineScope.launch {</code><div class="indented"><p id="4d395df2-c08e-49f2-bc10-8734c5d1af0d" class=""><code>viewModeel.saveItem()</code></p></div></p></div></p></li></ol></li></ol></li></ol><ol type="1" id="8d7939df-621f-43c8-a809-c2ea929dbf6e" class="numbered-list" start="7"><li><strong><strong><strong><strong><strong>Check</strong></strong></strong></strong></strong><p id="7dc22a14-4b76-4dc7-aba9-de0bd3ae6729" class="">Use Android Studio’s database inspector tool under App Inspection to ensure that data entered into the UI is being populated to the database.</p></li></ol><ol type="1" id="f78ab2fa-3aa4-4345-b636-f0e9265e3674" class="numbered-list" start="8"><li>Convert Flow to a State Flow in order to collect it using “collectAsState” within a Composable, from the collecting View Model<ol type="a" id="65ade471-c636-4384-a43b-f6c0b8527466" class="numbered-list" start="1"><li>For the collecting View Model, add a constructor parameter of the item repository<p id="79c9f6c6-e3e2-4de7-8c12-3ce0f140c38c" class=""><code>class HomeViewModel(itemsRepository: ItemsRepository): ViewModel() {</code></p></li></ol><ol type="a" id="e9bd235b-a8d6-4b90-b434-6f4b5826c935" class="numbered-list" start="2"><li>Declare a value of type State Flow and initialise using the get all items stream defined in the item repository earlier on<p id="31bf83a0-7a35-4d77-8d41-230ad13f8ee6" class=""><code>val homeUiState: StateFlow&lt;HomeUiState&gt; = itemsRepository.getAllItemsStream()</code></p></li></ol><ol type="a" id="c5fc6bb9-9c17-4343-a000-722ebb5e75e1" class="numbered-list" start="3"><li>Within the App View Model Provider file, in the specific View Model initialiser, pass in the Item Repository object<p id="ec8fbe7e-7f73-4523-aaa8-5412eb1d1360" class=""><code>initializer {</code><div class="indented"><p id="c616be47-04ba-441d-81b3-04e403c13215" class=""><code>HomeViewModel(inventoryApplication().container.itemsRepository)</code></p></div></p></li></ol><ol type="a" id="a5de2e25-9f33-4742-85ee-0cc89b04ed0a" class="numbered-list" start="4"><li>The above step will create a Flow of type List however we need to convert this type to the required State Flow. In order to resolve this we will apply a transformation map and use the <code>stateIn()</code> method to comvert the <code>Flow</code> into a <code>StateFlow</code>:<p id="ab9e7959-464d-4c5f-9788-a87193134146" class=""><code>val homeUiState: StateFlow&lt;HomeUiState&gt; = </code><div class="indented"><p id="0f9cc36c-a978-46bd-90f3-9be3aed0aea1" class=""><code>itemsRepository.getAllItemsStream().map { HomeUiState(it) }</code><div class="indented"><p id="e6ea5ab7-cef1-4fe9-9221-20b904169284" class=""><code>.stateIn(</code><div class="indented"><p id="17dd4f03-47dc-4fe6-a2f2-91200c02373c" class=""><code>scope = viewModelScope,</code></p><p id="68d9dc5c-e0ce-4eff-8598-c206c4bf25cd" class=""><code>started = SharingStarted.WhileSubscribed(TIMEOUT_MILLIS),</code></p><p id="aa66815c-5da0-4458-ad69-817d083ba648" class=""><code>initialValue = HomeUiState()</code></p></div></p></div></p></div></p></li></ol></li></ol><ol type="1" id="c07cb9ad-0c27-44d7-8d5f-6067dbabbd3e" class="numbered-list" start="9"><li>Add view model observer to calling Composable<ol type="a" id="c0983ca2-ecbe-4f29-95c8-79c1f3e6418d" class="numbered-list" start="1"><li>Add a View Model parameter to the calling screen with the app view model provider factory as default<p id="593e73e7-f6df-42ee-a4a5-74720ad8c087" class=""><code>viewModel: HomeViewModel = viewModel(factory = AppViewModelProvider.Factory),</code></p></li></ol><ol type="a" id="4df28d55-9478-4b94-aed1-c3b57e81fb53" class="numbered-list" start="2"><li>Add a value to the composable using collect as state to make it observable<p id="b6421453-5d61-4ed4-a7fe-06acc37a754f" class=""><code>val homeUiState by viewModel.homeUiState.collectAsState()</code></p></li></ol><ol type="a" id="b3643aa2-91a1-4e56-9d5a-35fa6e59d842" class="numbered-list" start="3"><li>Pass in this value to a composable to ensure that it displays as expected</li></ol></li></ol><ol type="1" id="ee073024-4e00-48bb-bef1-89d675b40f82" class="numbered-list" start="10"><li>Test Database with UI JUnit Tests:<ol type="a" id="20ab1c81-8f3e-4159-bbe6-ca8fabbce7eb" class="numbered-list" start="1"><li>Add gradle dependencies<p id="f51ed410-699e-43c7-8e94-5ee6384515e5" class=""><code>androidTestImplementation(&quot;androidx.test.espresso:espresso-core:3.5.1&quot;)</code></p><p id="9e16510b-9b65-4034-a05d-4e308f53fe16" class=""><code>androidTestImplementation(&quot;androidx.test.ext:junit:1.1.5&quot;)</code></p></li></ol><ol type="a" id="3ca3609d-f6f2-4cc0-bb1f-e1eef231bd78" class="numbered-list" start="2"><li>Create Kotlin UI test class<p id="0820ad3e-f090-4a59-a76b-4e43ec918f6e" class=""><code>src/androidTest/kotlin/ItemDaoTest.kt</code></p></li></ol><ol type="a" id="1ce997fe-97c1-426b-9c5d-f2477ed97aba" class="numbered-list" start="3"><li>Create a class using <code>@RunWith</code> annotation for Android JUnit 4 test<p id="efe3dc2b-f608-4e4f-a302-24d78103e686" class=""><code>@RunWith(AndroidJUnit4::class)</code></p><p id="b042a5b3-d669-45bf-b010-3d0275049c9d" class=""><code>class ItemDaoTest {</code></p></li></ol><ol type="a" id="c9aa1597-d997-45aa-8545-4837614b6253" class="numbered-list" start="4"><li>Add late initialised variables for the Item Dao and the Inventory Database<p id="50b057b4-d36d-493e-98a8-f39b5853a2ad" class=""><code>private lateinit var itemDao: ItemDao</code></p><p id="481a7fd3-caf5-4260-bc89-e86a44633270" class=""><code>private lateinit var inventoryDatabase: InventoryDatabase</code></p></li></ol><ol type="a" id="4c586a29-cf60-4d37-90ac-234a7b988212" class="numbered-list" start="5"><li>Create a function to create the database prior to testing, annotating it with <code>@Before</code> and initialising the Item Dao. The database is run in memory so that it does not persist after testing and is run on the main thread just for the purposes of testing.<pre id="79e44a7a-8c18-4400-b22f-f7208d2c0b30" class="code code-wrap"><code>@Before
fun createDb() {
    val context: Context = ApplicationProvider.getApplicationContext()
    // Using an in-memory database because the information stored here disappears when the
    // process is killed.
    inventoryDatabase = Room.inMemoryDatabaseBuilder(context, InventoryDatabase::class.java)
        // Allowing main thread queries, just for testing.
        .allowMainThreadQueries()
        .build()
    itemDao = inventoryDatabase.itemDao()
}</code></pre></li></ol><ol type="a" id="9aa3a32a-b633-4ce0-88f3-f25ea48782dd" class="numbered-list" start="6"><li>Create another function to close the database after completion, annotating it with <code>@After</code><p id="ac7b2c88-c96a-4483-ad64-e4584d52bde6" class=""><code>@After</code></p><p id="15c816ef-9635-41cd-8b7a-7fcd845a9789" class=""><code>@Throws(IOException::class)</code></p><p id="cb0fc016-3938-4de5-864c-535d4341d100" class=""><code>fun closeDB() {</code><div class="indented"><p id="c7da722e-92d8-447c-aaa9-f0320588bcc6" class=""><code>inventoryDatabase.close()</code></p></div></p></li></ol><ol type="a" id="39dc721a-95b8-4d6b-a53c-ebedfee5b2ef" class="numbered-list" start="7"><li>Declare items for testing as per the item database specifics<p id="bf2b8388-3228-4381-8c3f-d87742bd1122" class=""><code>private var item1 = Item(1, &quot;Apples&quot;, 10.0, 20)</code></p><p id="3e0faf2f-0cc9-42c0-83b4-f60215061d62" class=""><code>private var item2 = Item(2, &quot;Bananas&quot;, 15.0, 97)</code></p></li></ol><ol type="a" id="32efd6d1-0eb3-4d31-b927-5e17b86cb7fd" class="numbered-list" start="8"><li>Add utility functions to add one, two or more items to the database for testing<p id="1a1d60f3-1547-4cbf-9d02-eefc0be43c4a" class=""><code>private suspend fun addTwoItemsToDb() {</code><div class="indented"><p id="26765d79-cdf4-43d8-98d7-147dfb8fc23d" class=""><code>itemDao.insert(item1)</code></p><p id="f8be689d-4b09-4458-93e6-78add6f1d633" class=""><code>itemDao.insert(item2)</code></p></div></p></li></ol><ol type="a" id="31641016-0879-4064-afa1-1d0026944e79" class="numbered-list" start="9"><li>Test each item/s insertion function to ensure the database insertion is as expected. Test for individual items with <code>itemDao.getAllItems().first()</code></li></ol><ol type="a" id="082c56a0-7334-4534-ba20-e8c593fdba8f" class="numbered-list" start="10"><li></li></ol></li></ol><ol type="1" id="54d2fda1-1d22-41a5-bb22-9406aa6253a6" class="numbered-list" start="11"><li>a</li></ol><p id="2acabf83-7744-47cc-af70-16b34d3f90f7" class="">
</p><h2 id="038355b1-1282-4968-997a-465ce2f37f35" class="">Miscellaneous</h2><h3 id="21bcc5c2-c3c2-424d-ac55-6522cb4158ac" class="">ShareSheet</h3><p id="3b62ef5f-8284-4479-9704-3d58e90b8148" class="">ShareSheet is a user interface component within the Android operating system that covers the bottom part of the screen and provides the ability to share resources with external app interfaces. This Android OS component is called using an <code>intent</code><em>.</em></p><p id="4c9ce684-02cf-4a00-9eb7-2faa3b07ebc7" class="">An <code>intent</code><em><em><em><em><em> </em></em></em></em></em>is a request for the Andoid OS to perform an action, commonly presenting as a new activity. The process to set up an intent is as follows:<div class="indented"><ol type="1" id="6af173d9-d0bf-4d22-84ad-3344abc5034e" class="numbered-list" start="1"><li>Create an intent object and specify the intent ie <code>ACTIOIN_SEND</code></li></ol><ol type="1" id="680bc6e8-a90b-4ef7-9c94-8ff78a84aba4" class="numbered-list" start="2"><li>Specify the type of additional data being sent with the intent ie<em> </em><code>&quot;text/plain&quot;</code></li></ol><ol type="1" id="59af633a-a80a-4681-9adf-d437bb4524bd" class="numbered-list" start="3"><li>Pass any additional data to the intent such as text or image using the <code>putExtra()</code> method</li></ol><ol type="1" id="e80b5f61-0bdf-4b4c-9b1d-76b874230fc9" class="numbered-list" start="4"><li>Call the <code>startActivity()</code> method of context, passing in an activity created from the intent</li></ol></div></p><p id="b6c9c18c-08ad-4a77-8d3c-38f2b0c948a4" class="">Example using CupCake ordering app:</p><p id="df95c7c2-6760-4eb6-9019-95b2abc73ce8" class="">
</p><p id="3c2da74f-bd43-45eb-9cc4-539d74bf8ed5" class="">
</p><p id="7b6e5b93-37f7-4739-b9b7-931087de3be7" class="">
</p><p id="7345c009-f010-43a0-a5ff-d6ef93b64339" class="">
</p><p id="75f44cfd-d352-4e4f-baba-d308d8beb14c" class="">
</p><p id="205e83ca-9514-4138-b510-10c120dfd527" class="">
</p><h2 id="571085f5-7a44-4808-9240-b45f20bd26d3" class="">Further Reading</h2><ul id="5c058f1e-1d26-4831-a299-5ae2d4ddfab6" class="bulleted-list"><li style="list-style-type:disc">Google’s Recommended Android App Architecture:<ul id="f65a397a-2755-4711-9286-c0f080223839" class="bulleted-list"><li style="list-style-type:circle"><a href="https://developer.android.com/topic/architecture#recommended-app-arch">https://developer.android.com/topic/architecture#recommended-app-arch</a></li></ul></li></ul><ul id="a3120b62-101e-4e8c-8a13-1b91b579f818" class="bulleted-list"><li style="list-style-type:disc">Android Jetpack Libraries<ul id="73e59dd7-c69f-4b16-aba2-aeb994ccb3cc" class="bulleted-list"><li style="list-style-type:circle"><a href="https://developer.android.com/jetpack">https://developer.android.com/jetpack</a></li></ul></li></ul><ul id="69bce031-41dc-4b39-a332-5720955d50e2" class="bulleted-list"><li style="list-style-type:disc">The Guide to App Architecture<ul id="6d7df96a-6d07-48c2-8156-99edcbf68f5e" class="bulleted-list"><li style="list-style-type:circle"><a href="https://developer.android.com/topic/libraries/architecture">https://developer.android.com/topic/libraries/architecture</a></li></ul></li></ul><ul id="ac45dd13-2e85-482e-b865-a4e9c655644b" class="bulleted-list"><li style="list-style-type:disc">Permissions on Android<ul id="11b62cd3-d5f0-4bd7-99b8-7b2321eac460" class="bulleted-list"><li style="list-style-type:circle"><a href="https://developer.android.com/guide/topics/permissions/overview">https://developer.android.com/guide/topics/permissions/overview</a></li></ul></li></ul></div></article></body></html>